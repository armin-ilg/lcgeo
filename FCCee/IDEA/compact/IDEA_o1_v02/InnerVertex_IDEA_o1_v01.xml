<!-- Changes :
   o1_v01 : First version for IDEA in k4geo, corresponding to state described in MDI+vertex mid-term report first draft (14.07.2023)
-->

<lccdd>
    <info name="Vertex_IDEA_o1_v02"
        title="IDEA vertex detector: Started with CLD vertex detector design from FCCDetectors, but adapted to IDEA vertex detector and extended functionality of detector builders"
        author="Niloufar Alipour Tehrani (adapting original CLD version), Armin Ilg (adapting and extending to IDEA)"
        url="no"
        status="development"
        version="o1_v02"> 
        <comment>A Vertex Detector for the FCC-ee IDEA detector concept, based on the engineered design by Fabrizio Palla and Filippo Bosi (INFN Pisa), implemented in DD4hep by Armin Ilg (UZH)</comment>
    </info>
    <comment>Vertex inner barrel </comment>
    <detectors>
        <detector name="InnerVertex" type="DD4hep_SubdetectorAssembly" vis="VXDVis">
            <shape type="BooleanShape" operation="Subtraction" material="Air">
                <shape type="BooleanShape" operation="Subtraction">
                    <shape type="Tube" rmin="VTXIB_r_min_layer-VTXIB_r_min_clearance" rmax="VTXIB_r_max_layer+VTXIB_r_max_clearance" dz="VTXOB_half_length"/>
                    <shape type="Cone" rmin1="0" rmax1="tan(VertexClearanceTheta)*VTXOB_half_length" rmin2="0" rmax2="0" z="VTXOB_half_length/2."/>
                    <position x="0" y="0" z="-VTXOB_half_length/2." />
                </shape>
                
                <shape type="Cone" rmin1="0" rmax1="0" rmin2="0" rmax2="tan(VertexClearanceTheta)*VTXOB_half_length" z="VTXOB_half_length/2."/>
                <position x="0" y="0" z="VTXOB_half_length/2." />
            </shape>
            <comment>Vertex Assembly</comment>
            <composite name="VTXIB"/>
            <composite name="VTXIBSupport"/>
        </detector>
    </detectors>


    <define>
        <!-- Vertex inner barrel (VTXIB): Let's take the ARCADIA sensor! -->
            <constant name="VTXIB_sens_z" value="1.6*cm"/> <!-- Chip length, use modified ARCADIA with length of 1.6cm instead of 2.56cm-->       
            <constant name="VTXIB_sens_rphi_sensitive" value="6.4*mm"/> <!-- Chip length: Sensitive-->
            <constant name="VTXIB_sens_rphi_periphery" value="2*mm"/> <!-- Chip length: Periphery-->
            <constant name="VTXIB_sens_rphi" value="VTXIB_sens_rphi_sensitive+VTXIB_sens_rphi_periphery"/> <!-- Chip length: Sensitive-->
    
            <!-- Module with two ARCADIA chips -->
            <constant name="VTXIB_mod_z" value="VTXIB_sens_z*2"/> <!-- 32 mm -->
            <constant name="VTXIB_mod_rphi_sensitive" value="VTXIB_sens_rphi_sensitive"/> 
            <constant name="VTXIB_mod_rphi_periphery" value="VTXIB_sens_rphi_periphery"/>
            <constant name="VTXIB_mod_rphi" value="VTXIB_sens_rphi"/>


        <!-- Vertex inner barrel parameters -->
            <constant name="VTXIB_L1_Staves" value="15"/>
            <constant name="VTXIB_L2_Staves" value="24"/>
            <constant name="VTXIB_L3_Staves" value="36"/>
            
            <constant name="VTXIB_L1_nModules" value="6"/>
            <constant name="VTXIB_L2_nModules" value="10"/>
            <constant name="VTXIB_L3_nModules" value="16"/>
    
            <constant name="VTXIB_mod_z_spacing" value="0.2*mm"/>
    
            <constant name="VTXIB_z1" value="(VTXIB_L1_nModules*VTXIB_mod_z+(VTXIB_L1_nModules-1)*VTXIB_mod_z_spacing)/2.0"/> <!-- 96.5*mm -->
            <constant name="VTXIB_z2" value="(VTXIB_L2_nModules*VTXIB_mod_z+(VTXIB_L2_nModules-1)*VTXIB_mod_z_spacing)/2.0"/> <!-- 160.9*mm -->
            <constant name="VTXIB_z3" value="(VTXIB_L3_nModules*VTXIB_mod_z+(VTXIB_L3_nModules-1)*VTXIB_mod_z_spacing)/2.0"/> <!-- 257.5*mm -->
            <constant name="VTXIB_r1" value="VTXIB_r_min_layer"/> 
            <constant name="VTXIB_r2" value="22.7*mm"/>
            <constant name="VTXIB_r3"  value="VTXIB_r_max_layer"/> <!-- 34 mm-->

            <constant name="VTXIB_dr1" value="0.0*mm"/>
            <constant name="VTXIB_dr2" value="0.0*mm"/>
            <constant name="VTXIB_dr3" value="1.6*mm"/>  <!-- Offset in r of every second stave -->

            <constant name="VTXIB_Sensitive_Thickness"   value="50e-03*mm"/>
            <constant name="VTXIB_Support_Thickness"     value="200e-03*mm"/>
            <constant name="VTXIB_Glue_Thickness"     value="70e-03*mm"/>
            <constant name="VTXIB_Support_width"     value="4.4*mm"/>
    
            <constant name="VTXIB_L3_overlap" value="0.4*mm"/>        
            
            <constant name="VTXIB_L1_offset" value="-3.751*mm"/>
            <constant name="VTXIB_L2_offset" value="3.255*mm"/>
            <constant name="VTXIB_L3_offset" value="0*mm"/>

            <constant name="VTXIB_hybrid_z" value="12.0*mm"/>
            <constant name="VTXIB_endOfStave_Thickness" value="0.250*mm"/>


            <!-- Flex for inner vertex barrel readout -->
            <constant name="VTXIB_flex_width" value="1.8*mm"/>
            <constant name="VTXIB_flex_offset" value="VTXIB_Support_width/2.+VTXIB_flex_width/2."/> <!-- offset in r-phi -->
            <constant name="VTXIB_flex_Aluminium_thickness" value="0.050*mm"/>
            <constant name="VTXIB_flex_Kapton_thickness" value="0.200*mm"/>

            <!-- Inner vertex barrel holder made out of Rohacell and carbonfiber -->
            <constant name="VTXIB_L1_Holder_Thickness"      value="5.0*mm"/>
            <constant name="VTXIB_L2_Holder_Thickness"      value="7.0*mm"/>
            <constant name="VTXIB_L3_Holder_Thickness"      value="10.0*mm"/>
            <constant name="VTXIB_L1_Holder_Rohacell_rphi"  value="1.0*mm"/>
            <constant name="VTXIB_L2_Holder_Rohacell_rphi"  value="2.0*mm"/>
            <constant name="VTXIB_L3_Holder_Rohacell_rphi"  value="1.0*mm"/>
            <constant name="VTXIB_Holder_CarbonFiber_rphi"  value="0.2*mm"/>
    </define>        


    <!--  Definition of the readout segmentation/definition  -->
    <readouts>
        <readout name="VTXIBCollection">
            <segmentation type="CartesianGridYZ" grid_size_y="0.025*mm" grid_size_z="0.025*mm"/>  <!-- Pixels of 25x25 Âµm-->
            <id>${GlobalTrackerReadoutID},y:32:-16,z:-16</id>
        </readout>
    </readouts>

   <detectors>
 
    <!-- Vertex inner barrel -->
        <detector name="VTXIB" type="VertexBarrel_detailed_o1_v01" vis="VXDVis" id="DetID_VXD_IB" readout="VTXIBCollection"  region="VTXIBRegion">
            <envelope vis="VXDVis">
                <shape type="Assembly"/>
            </envelope>
            <type_flags type=" DetType_TRACKER + DetType_PIXEL + DetType_VERTEX + DetType_BARREL"/>
            
            <!-- Definition of our "stave" object that is used to build the barrel -->
            <stave name="SiVTXIBStave1">
                <!-- Sensor -->
                <sensor r="0.0*mm" thickness="VTXIB_Sensitive_Thickness" material="Silicon">
                    <component sensitive="False"    xmin="-VTXIB_mod_rphi/2.0+VTXIB_mod_rphi_sensitive" xmax="VTXIB_mod_rphi/2.0"                                       ymin="-VTXIB_mod_z/2.0" ymax="+VTXIB_mod_z/2.0" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="-VTXIB_mod_rphi/2.0"                                      xmax="-VTXIB_mod_rphi/2.0+VTXIB_mod_rphi_sensitive" ymin="-VTXIB_mod_z/2.0" ymax="+VTXIB_mod_z/2.0" vis="SiSensitiveVis"/>
                </sensor>

                <components name="support" r="VTXIB_Sensitive_Thickness" length="VTXIB_z1">
                    <component thickness="VTXIB_Glue_Thickness" width="VTXIB_mod_rphi" offset="0.0*mm" r="0.0*mm" material="GlueEcobond45" vis="SupportVis"/>
                    <component thickness="VTXIB_Support_Thickness" width="VTXIB_Support_width" offset="0.0*mm" r="VTXIB_Glue_Thickness" material="CarbonFiberVtx" vis="GlueVis"/>
                    <component thickness="VTXIB_L1_Holder_Thickness"  width="VTXIB_L1_Holder_Rohacell_rphi" offset="0.0*mm" r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="RohacellVtx66D" vis="RohacellVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L1_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" offset="-VTXIB_L1_Holder_Rohacell_rphi/2.0-VTXIB_Holder_CarbonFiber_rphi/2.0" r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="CarbonFiberVtx66D" vis="SupportVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L1_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" offset="VTXIB_L1_Holder_Rohacell_rphi/2.0+VTXIB_Holder_CarbonFiber_rphi/2.0"  r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="CarbonFiberVtx66D" vis="SupportVis"/> <!-- Holder structure -->
                </components>

                <components name="flexes" r="VTXIB_Sensitive_Thickness+VTXIB_Glue_Thickness+VTXIB_Support_Thickness" length="VTXIB_z1">
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" r="0.0*mm" offset="VTXIB_flex_offset" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" r="VTXIB_flex_Kapton_thickness" offset="VTXIB_flex_offset" material="Al" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" r="0.0*mm" offset="-VTXIB_flex_offset" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" r="VTXIB_flex_Kapton_thickness" offset="-VTXIB_flex_offset" material="Al" vis="CableVis"/>
                </components>

                <!-- End of stave structures -->
                <end_z name="endOfStave" r="0.0*mm">
                    <!-- Hybrid -->
                    <component thickness="VTXIB_endOfStave_Thickness" width="VTXIB_mod_rphi" length="VTXIB_hybrid_z" dz="VTXIB_mod_z_spacing" r="0.0*mm" material="PCB" vis="HybridVis"/>

                    <!-- Rest of flexes -->
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+0.0*mm" offset="VTXIB_flex_offset" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+VTXIB_flex_Kapton_thickness" offset="VTXIB_flex_offset" material="Al" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+0.0*mm" offset="-VTXIB_flex_offset" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+VTXIB_flex_Kapton_thickness" offset="-VTXIB_flex_offset" material="Al" vis="CableVis"/>

                    <!-- Rest of holder -->
                    <component thickness="VTXIB_L1_Holder_Thickness"  width="VTXIB_L1_Holder_Rohacell_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="0.0*mm"                                                                 r="VTXIB_endOfStave_Thickness" material="RohacellVtx66D"       vis="RohacellVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L1_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="-VTXIB_L1_Holder_Rohacell_rphi/2.0-VTXIB_Holder_CarbonFiber_rphi/2.0"   r="VTXIB_endOfStave_Thickness" material="CarbonFiberVtx66D"    vis="SupportVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L1_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="VTXIB_L1_Holder_Rohacell_rphi/2.0+VTXIB_Holder_CarbonFiber_rphi/2.0"    r="VTXIB_endOfStave_Thickness" material="CarbonFiberVtx66D"    vis="SupportVis"/> <!-- Holder structure -->
                </end_z>
            </stave>

            <!-- Definition of our "stave" object that is used to build the barrel, this time for layer 2 -->
            <stave name="SiVTXIBStave2">
                <!-- Sensor -->
                <sensor r="0.0*mm" thickness="VTXIB_Sensitive_Thickness" material="Silicon">
                    <component sensitive="False"    xmin="-VTXIB_mod_rphi/2.0"                          xmax="-VTXIB_mod_rphi/2.0+VTXIB_mod_rphi_periphery" ymin="-VTXIB_mod_z/2.0" ymax="+VTXIB_mod_z/2.0" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="-VTXIB_mod_rphi/2.0+VTXIB_mod_rphi_periphery" xmax="VTXIB_mod_rphi/2.0"                           ymin="-VTXIB_mod_z/2.0" ymax="+VTXIB_mod_z/2.0" vis="SiSensitiveVis"/>
                </sensor>

                <components name="support" r="VTXIB_Sensitive_Thickness" length="VTXIB_z2">
                    <component thickness="VTXIB_Glue_Thickness" width="VTXIB_mod_rphi" offset="0.0*mm" r="0.0*mm" material="GlueEcobond45" vis="SupportVis"/>
                    <component thickness="VTXIB_Support_Thickness" width="VTXIB_Support_width" offset="0.0*mm" r="VTXIB_Glue_Thickness" material="CarbonFiberVtx" vis="SupportVis"/>
                    <component thickness="VTXIB_L2_Holder_Thickness"  width="VTXIB_L2_Holder_Rohacell_rphi" offset="0.0*mm" r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="RohacellVtx66D" vis="RohacellVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L2_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" offset="-VTXIB_L2_Holder_Rohacell_rphi/2.0-VTXIB_Holder_CarbonFiber_rphi/2.0" r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="CarbonFiberVtx66D" vis="SupportVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L2_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" offset="VTXIB_L2_Holder_Rohacell_rphi/2.0+VTXIB_Holder_CarbonFiber_rphi/2.0"  r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="CarbonFiberVtx66D" vis="SupportVis"/> <!-- Holder structure -->
                </components>

                <components name="flexes" r="VTXIB_Sensitive_Thickness+VTXIB_Glue_Thickness+VTXIB_Support_Thickness" length="VTXIB_z2">
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" r="0.0*mm" offset="VTXIB_flex_offset" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" r="VTXIB_flex_Kapton_thickness" offset="VTXIB_flex_offset" material="Al" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" r="0.0*mm" offset="-VTXIB_flex_offset" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" r="VTXIB_flex_Kapton_thickness" offset="-VTXIB_flex_offset" material="Al" vis="CableVis"/>
                </components>

                <!-- End of stave structures -->
                <end_z name="endOfStave" r="0.0*mm">
                    <!-- Hybrid -->
                    <component thickness="VTXIB_endOfStave_Thickness" width="VTXIB_mod_rphi" length="VTXIB_hybrid_z" dz="VTXIB_mod_z_spacing" r="0.0*mm" material="PCB" vis="HybridVis"/>

                    <!-- Rest of flexes -->
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+0.0*mm"                       offset="VTXIB_flex_offset"  material="KaptonVtx"    vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+VTXIB_flex_Kapton_thickness"  offset="VTXIB_flex_offset"  material="Al"           vis="CableVis"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+0.0*mm"                       offset="-VTXIB_flex_offset" material="KaptonVtx"    vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+VTXIB_flex_Kapton_thickness"  offset="-VTXIB_flex_offset" material="Al"           vis="CableVis"/>

                    <!-- Rest of holder -->
                    <component thickness="VTXIB_L2_Holder_Thickness"  width="VTXIB_L2_Holder_Rohacell_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="0.0*mm"                                                                 r="VTXIB_endOfStave_Thickness" material="RohacellVtx66D"       vis="RohacellVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L2_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="-VTXIB_L2_Holder_Rohacell_rphi/2.0-VTXIB_Holder_CarbonFiber_rphi/2.0"   r="VTXIB_endOfStave_Thickness" material="CarbonFiberVtx66D"    vis="SupportVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L2_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="VTXIB_L2_Holder_Rohacell_rphi/2.0+VTXIB_Holder_CarbonFiber_rphi/2.0"    r="VTXIB_endOfStave_Thickness" material="CarbonFiberVtx66D"    vis="SupportVis"/> <!-- Holder structure -->
                </end_z>
            </stave>

            <!-- Definition of our "stave" object that is used to build the barrel. There are two different versions for layer 3 as they are mirrored in x-y and are at a different r -->
            <stave name="SiVTXIBStave3">
                <!-- Sensor -->
                <sensor r="0.0*mm" thickness="VTXIB_Sensitive_Thickness" material="Silicon">
                    <component sensitive="False"    xmin="-VTXIB_mod_rphi/2.0+VTXIB_mod_rphi_sensitive" xmax="VTXIB_mod_rphi/2.0"                                       ymin="-VTXIB_mod_z/2.0" ymax="+VTXIB_mod_z/2.0" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="-VTXIB_mod_rphi/2.0"                                      xmax="-VTXIB_mod_rphi/2.0+VTXIB_mod_rphi_sensitive" ymin="-VTXIB_mod_z/2.0" ymax="+VTXIB_mod_z/2.0" vis="SiSensitiveVis"/>
                </sensor>

                <components name="support" r="VTXIB_Sensitive_Thickness" length="VTXIB_z3">
                    <component thickness="VTXIB_Glue_Thickness" width="VTXIB_mod_rphi" offset="0.0*mm" r="0.0*mm" material="GlueEcobond45" vis="SupportVis"/>
                    <component thickness="VTXIB_Support_Thickness" width="VTXIB_Support_width" offset="0.0*mm" r="VTXIB_Glue_Thickness" material="CarbonFiberVtx" vis="SupportVis"/> 
                    <component thickness="VTXIB_L3_Holder_Thickness"  width="VTXIB_L3_Holder_Rohacell_rphi" offset="0.0*mm" r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="RohacellVtx66D" vis="RohacellVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L3_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" offset="-VTXIB_L3_Holder_Rohacell_rphi/2.0-VTXIB_Holder_CarbonFiber_rphi/2.0" r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="CarbonFiberVtx66D" vis="SupportVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L3_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" offset="VTXIB_L3_Holder_Rohacell_rphi/2.0+VTXIB_Holder_CarbonFiber_rphi/2.0"  r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="CarbonFiberVtx66D" vis="SupportVis"/> <!-- Holder structure -->
                </components>

                <components name="flexes" r="VTXIB_Sensitive_Thickness+VTXIB_Glue_Thickness+VTXIB_Support_Thickness" length="VTXIB_z3">
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" r="0.0*mm" offset="VTXIB_flex_offset" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" r="VTXIB_flex_Kapton_thickness" offset="VTXIB_flex_offset" material="Al" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" r="0.0*mm" offset="-VTXIB_flex_offset" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" r="VTXIB_flex_Kapton_thickness" offset="-VTXIB_flex_offset" material="Al" vis="CableVis"/>
                </components>

                <!-- End of stave structures -->
                <end_z name="endOfStave" r="0.0*mm">
                    <!-- Hybrid -->
                    <component thickness="VTXIB_endOfStave_Thickness" width="VTXIB_mod_rphi" length="VTXIB_hybrid_z" dz="VTXIB_mod_z_spacing" r="0.0*mm" material="PCB" vis="HybridVis"/>

                    <!-- Rest of flexes -->
                    <component thickness="VTXIB_flex_Kapton_thickness"      width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+0.0*mm"                       offset="VTXIB_flex_offset"  material="KaptonVtx"    vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"   width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+VTXIB_flex_Kapton_thickness"  offset="VTXIB_flex_offset"  material="Al"           vis="CableVis"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"      width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+0.0*mm"                       offset="-VTXIB_flex_offset" material="KaptonVtx"    vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"   width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+VTXIB_flex_Kapton_thickness"  offset="-VTXIB_flex_offset" material="Al"           vis="CableVis"/>

                    <!-- Rest of holder -->
                    <component thickness="VTXIB_L3_Holder_Thickness"  width="VTXIB_L3_Holder_Rohacell_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="0.0*mm"                                                                 r="VTXIB_endOfStave_Thickness" material="RohacellVtx66D"       vis="RohacellVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L3_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="-VTXIB_L3_Holder_Rohacell_rphi/2.0-VTXIB_Holder_CarbonFiber_rphi/2.0"   r="VTXIB_endOfStave_Thickness" material="CarbonFiberVtx66D"    vis="SupportVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L3_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="VTXIB_L3_Holder_Rohacell_rphi/2.0+VTXIB_Holder_CarbonFiber_rphi/2.0"    r="VTXIB_endOfStave_Thickness" material="CarbonFiberVtx66D"    vis="SupportVis"/> <!-- Holder structure -->
                </end_z>
            </stave>

            <!-- Here we construct the barrel -->
            <layer nLadders="VTXIB_L1_Staves" phi0="0.0" r="VTXIB_r1" offset="VTXIB_L1_offset" id="0" nmodules="VTXIB_L1_nModules" name="SiVTXIBStave1" step="VTXIB_mod_z_spacing" dr="VTXIB_dr1"/>
            <layer nLadders="VTXIB_L2_Staves" phi0="0.0" r="VTXIB_r2" offset="VTXIB_L2_offset" id="1" nmodules="VTXIB_L2_nModules" name="SiVTXIBStave2" step="VTXIB_mod_z_spacing" dr="VTXIB_dr2"/>
            <layer nLadders="VTXIB_L3_Staves" phi0="0.0" r="VTXIB_r3" offset="VTXIB_L3_offset" id="2" nmodules="VTXIB_L3_nModules" name="SiVTXIBStave3" step="VTXIB_mod_z_spacing" dr="VTXIB_dr3"/>
        </detector>


        <!-- Vertex inner barrel support structure imported via DDCAD, material budget evaluation with g4MaterialScan is working, but not with the k4SimGeant4 methods. Should be furthermore rotated by 90 degrees around z, but feature not working currently -->
         <detector id="DetID_NOTUSED" name="VTXIBSupport" type="DD4hep_TestShape_Creator">
            <envelope vis="VXDVis">
                <shape type="Assembly"/>
            </envelope>
            <check>
                <shape type="CAD_MultiVolume" ref="VertexSupport_o1_v02.obj" unit="mm"/>
                <rotation x="0" y="0" z="0"/>
            </check>
        </detector> 
    </detectors>   
   
    <!-- Plugin to define the sensitive surfaces -->
    <plugins>
        <plugin name="DD4hep_GenericSurfaceInstallerPlugin">
            <argument value="VTXIB"/> 
            <argument value="dimension=2"/>
            <argument value="u_y=1."/>
            <argument value="v_z=1."/>
            <argument value="n_x=1."/>
        </plugin>
    </plugins> 
</lccdd>