<!-- Changes :
   o1_v01 : First version for IDEA in k4geo, corresponding to state described in MDI+vertex mid-term report first draft (14.07.2023)
-->

<lccdd>
    <info name="Vertex_IDEA_o1_v02"
        title="IDEA vertex detector: Started with CLD vertex detector design from FCCDetectors, but adapted to IDEA vertex detector and extended functionality of detector builders"
        author="Niloufar Alipour Tehrani (adapting original CLD version), Armin Ilg (adapting and extending to IDEA)"
        url="no"
        status="development"
        version="o1_v02"> 
        <comment>A Vertex Detector for the FCC-ee IDEA detector concept, based on the engineered design by Fabrizio Palla and Filippo Bosi (INFN Pisa), implemented in DD4hep by Armin Ilg (UZH)</comment>
    </info>
    <comment>Vertex inner barrel </comment>

    <display>
        <vis name="TerminalPartVis"     alpha="1.0" r="1.0"     g="0.65" b="0.0"    showDaughters="true"  visible="true"/>
        <vis name="TrussStructureVis"   alpha="0.3" r="0.5"     g="0.5"  b="0.5"    showDaughters="true"  visible="true"/>
    </display>

    <define>
        <constant name="nInnerVertexLayers" value="4"/>
        <!-- <constant name="nInnerVertexLayers" value="3"/> -->
    </define>


    <define>
        <!-- Vertex inner barrel (VTXIB): Let's take the ARCADIA sensor! -->
            <constant name="VTXIB_sens_z" value="1.6*cm"/> <!-- Chip length, use modified ARCADIA with length of 1.6cm instead of 2.56cm-->       
            <constant name="VTXIB_sens_rphi_sensitive" value="6.4*mm"/> <!-- Chip length: Sensitive-->
            <constant name="VTXIB_sens_rphi_periphery" value="2*mm"/> <!-- Chip length: Periphery-->
            <constant name="VTXIB_sens_rphi" value="VTXIB_sens_rphi_sensitive+VTXIB_sens_rphi_periphery"/> <!-- Chip length: Sensitive-->
    
            <!-- Module with two ARCADIA chips -->
            <constant name="VTXIB_mod_z" value="VTXIB_sens_z*2"/> <!-- 32 mm -->
            <constant name="VTXIB_mod_rphi_sensitive" value="VTXIB_sens_rphi_sensitive"/> 
            <constant name="VTXIB_mod_rphi_periphery" value="VTXIB_sens_rphi_periphery"/>
            <constant name="VTXIB_mod_rphi" value="VTXIB_sens_rphi"/>


        <!-- Vertex inner barrel parameters -->
            <constant name="VTXIB_L1_Staves" value="15"/>
            <constant name="VTXIB_L2_Staves" value="24"/>
            <constant name="VTXIB_L3_Staves" value="36"/>
            
            <constant name="VTXIB_L1_nModules" value="6"/>
            <constant name="VTXIB_L2_nModules" value="10"/>
            <constant name="VTXIB_L3_nModules" value="16"/>
    
            <constant name="VTXIB_mod_z_spacing" value="0.2*mm"/>
    
            <constant name="VTXIB_z1" value="(VTXIB_L1_nModules*VTXIB_mod_z+(VTXIB_L1_nModules-1)*VTXIB_mod_z_spacing)/2.0"/> <!-- 96.5*mm -->
            <constant name="VTXIB_z2" value="(VTXIB_L2_nModules*VTXIB_mod_z+(VTXIB_L2_nModules-1)*VTXIB_mod_z_spacing)/2.0"/> <!-- 160.9*mm -->
            <constant name="VTXIB_z3" value="(VTXIB_L3_nModules*VTXIB_mod_z+(VTXIB_L3_nModules-1)*VTXIB_mod_z_spacing)/2.0"/> <!-- 257.5*mm -->
            <constant name="VTXIB_r1" value="VTXIB_r_min_layer"/> 
            <constant name="VTXIB_r2" value="22.7*mm"/>
            <constant name="VTXIB_r3"  value="VTXIB_r_max_layer"/> <!-- 34 mm-->

            <constant name="VTXIB_dr1" value="0.0*mm"/>
            <constant name="VTXIB_dr2" value="0.0*mm"/>
            <constant name="VTXIB_dr3" value="1.6*mm"/>  <!-- Offset in r of every second stave -->

            <constant name="VTXIB_Sensitive_Thickness"   value="50e-03*mm"/>
            <constant name="VTXIB_Support_Thickness"     value="200e-03*mm"/>
            <constant name="VTXIB_Glue_Thickness"     value="70e-03*mm"/>
            <constant name="VTXIB_Support_width"     value="4.4*mm"/>
    
            <constant name="VTXIB_L3_overlap" value="0.4*mm"/>        
            
            <constant name="VTXIB_L1_offset" value="-3.751*mm"/>
            <constant name="VTXIB_L2_offset" value="3.255*mm"/>
            <constant name="VTXIB_L3_offset" value="0*mm"/>

            <constant name="VTXIB_hybrid_z" value="12.0*mm"/>
            <constant name="VTXIB_endOfStave_Thickness" value="0.250*mm"/>


            <!-- Flex for inner vertex barrel readout -->
            <constant name="VTXIB_flex_width" value="1.8*mm"/>
            <constant name="VTXIB_flex_offset" value="VTXIB_Support_width/2.+VTXIB_flex_width/2."/> <!-- offset in r-phi -->
            <constant name="VTXIB_flex_Aluminium_thickness" value="0.050*mm"/>
            <constant name="VTXIB_flex_Kapton_thickness" value="0.200*mm"/>

            <!-- Inner vertex barrel holder made out of Rohacell and carbonfiber -->
            <constant name="VTXIB_L1_Holder_Thickness"      value="5.0*mm"/>
            <constant name="VTXIB_L2_Holder_Thickness"      value="7.0*mm"/>
            <constant name="VTXIB_L3_Holder_Thickness"      value="10.0*mm"/>
            <constant name="VTXIB_L1_Holder_Rohacell_rphi"  value="1.0*mm"/>
            <constant name="VTXIB_L2_Holder_Rohacell_rphi"  value="2.0*mm"/>
            <constant name="VTXIB_L3_Holder_Rohacell_rphi"  value="1.0*mm"/>
            <constant name="VTXIB_Holder_CarbonFiber_rphi"  value="0.2*mm"/>

            <constant name="VTXIB_half_length" value="VTXIB_z3+VTXIB_hybrid_z+VTXIB_mod_z_spacing"/> <!-- 140.95*mm -->


        <!-- Vertex outer barrel (VTXOB) + disks (VTXD): Let's take the ATLASPix3 sensor -->
            <constant name="VTXO_sens_z_sensitive" value="19.8*mm"/> <!-- Chip length in z: Sensitive -->
            <constant name="VTXO_sens_z_periphery" value="0.4*mm"/> <!-- Chip length in z: Periphery -->
            <constant name="VTXO_sens_z" value="VTXO_sens_z_sensitive+VTXO_sens_z_periphery"/> <!-- Chip length in z: Total -->
            <constant name="VTXO_sens_rphi_sensitive" value="18.6*mm"/> <!-- Chip length in r-phi: Sensitive-->
            <constant name="VTXO_sens_rphi_periphery" value="2.4*mm"/> <!-- Chip length in r-phi: Periphery-->
            <constant name="VTXO_sens_rphi" value="VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery"/> <!-- Chip length in r-phi: Total -->
            <constant name="VTXO_sens_rphi_sens_spacing" value="0.2*mm"/> <!-- Distance between individual readout chips in rphi -->
            <constant name="VTXO_sens_z_sens_spacing" value="0.2*mm"/> <!-- Distance between individual readout chips in rphi -->
    
            <!-- Module with four ATLASPix3-like chips -->
            <constant name="VTXO_mod_z_sensitive" value="VTXO_sens_z_sensitive*2"/>
            <constant name="VTXO_mod_z_periphery" value="VTXO_sens_z_periphery*2+VTXO_sens_z_sens_spacing"/>
            <constant name="VTXO_mod_z" value="VTXO_mod_z_sensitive+VTXO_mod_z_periphery"/> <!-- 40.6*mm -->
    
            <constant name="VTXO_mod_rphi_sensitive" value="VTXO_sens_rphi_sensitive*2"/>
            <constant name="VTXO_mod_rphi_periphery" value="VTXO_sens_rphi_periphery*2+VTXO_sens_rphi_sens_spacing"/>
            <constant name="VTXO_mod_rphi" value="VTXO_mod_rphi_sensitive+VTXO_mod_rphi_periphery"/>
        
            <constant name="VTXO_Sensitive_Thickness" value="5e-02*mm"/>


        <!-- Vertex outer barrel and disks joint parameters -->
            <!-- Stave-long support -->
            <constant name="VTXO_support_Fleece_thickness"          value="20e-03*mm"/>
            <constant name="VTXO_support_PaperGraphite_thickness"   value="25e-03*mm"/>
            <constant name="VTXO_support_CarbonFiber_thickness"     value="120e-03*mm"/>

            <!-- Cooling pipes -->
            <constant name="VTXO_Pipe_thickness"                    value="0.0955*mm"/>
            <constant name="VTXO_Pipe_rphi"                         value="2.0*mm"/>
            <constant name="VTXO_Water_thickness"                   value="2.0*mm"/>

            <!-- Flex: 2 layers of 50 µm Aluminum, 2 layers of 150 µm kapton and 100 µm glue -->
            <constant name="VTXO_flex_width" value="16.2*mm"/>
            <constant name="VTXO_flex_Aluminium_thickness" value="0.100*mm"/>
            <constant name="VTXO_flex_Kapton_thickness" value="0.300*mm"/>
            <constant name="VTXO_flex_Glue_thickness" value="0.100*mm"/>
            <constant name="VTXO_flex_thickness" value="VTXO_flex_Aluminium_thickness+VTXO_flex_Kapton_thickness+VTXO_flex_Glue_thickness"/>

            <!-- Hybrid at the end of the stave -->
            <constant name="VTXO_hybrid_thickness" value="0.4*mm"/>
            <constant name="VTXO_hybrid_length" value="12.1*mm"/>
            <constant name="VTXO_hybrid_dx" value="0.1*mm"/>

        <!-- Vertex outer barrel parameters -->
            <constant name="VTXOB_Staves1" value="23"/>
            <constant name="VTXOB_Staves2" value="51"/>
            <constant name="VTXOB_nModules1" value="8"/>            <!-- 163.1 mm-->
            <constant name="VTXOB_nModules2" value="16"/>           <!-- 326.3 mm -->
            <constant name="VTXOB_mod_z_spacing" value="0.2*mm"/>   <!-- Must be done for disks as well! Currently not done -->
    
            <constant name="VTXOB_z1" value="(VTXOB_nModules1*VTXO_mod_z+(VTXOB_nModules1-1)*VTXOB_mod_z_spacing)/2.0"/>
            <constant name="VTXOB_z2" value="(VTXOB_nModules2*VTXO_mod_z+(VTXOB_nModules2-1)*VTXOB_mod_z_spacing)/2.0"/>
            <constant name="VTXOB_r1" value="VTXOB_r_min_layer"/>   <!-- 140 mm-->
            <constant name="VTXOB_r2" value="VTXOB_r_max_layer"/>   <!-- 315 mm -->

            <constant name="VTXOB_support_thickness"                value="2.0*VTXO_support_Fleece_thickness+VTXO_support_CarbonFiber_thickness+VTXO_support_PaperGraphite_thickness"/>
            <constant name="VTXOB_Pipe_offset"                      value="21.18*mm/2.0"/>
            <constant name="VTXOB_TrussStructure_thickness1"        value="0.501*mm"/> <!-- 326 mm length * 8.4 mm width / 5464.3 mm^3 volume = 0.501 mm of proxy carbon fiber thickness for light-weight truss structure -->
            <constant name="VTXOB_TrussStructure_thickness2"        value="0.477*mm"/> <!-- 652 mm length * 8.4 mm width / 11473.8 mm^3 volume = 0.477 mm of proxy carbon fiber thickness for light-weight truss structure -->
            <constant name="VTXOB_TrussStructure_distance"          value="3.3*mm"/>
    
            <constant name="VTXOB_offset1" value="10.0*mm"/>
            <constant name="VTXOB_offset2" value="20.0*mm"/>

            <!-- Proxy for terminal part in VTXOB made out of PEEK, used in middle tracker barrel-->
            <constant name="VTXOB_TerminalPart_L1_width1"        value="(34.436*mm+25.604*mm)/2."/>
            <constant name="VTXOB_TerminalPart_L1_length1"        value="7.0*mm"/>
            <constant name="VTXOB_TerminalPart_L1_thickness1"        value="744.577*mm*mm*mm/VTXOB_TerminalPart_L1_width1/VTXOB_TerminalPart_L1_length1"/>

            <constant name="VTXOB_TerminalPart_L1_width2"        value="(25.604*mm+18.244*mm)/2."/>
            <constant name="VTXOB_TerminalPart_L1_length2"        value="7.0*mm"/>
            <constant name="VTXOB_TerminalPart_L1_thickness2"        value="542.961*mm*mm*mm/VTXOB_TerminalPart_L1_width2/VTXOB_TerminalPart_L1_length2"/>
                     
            <constant name="VTXOB_TerminalPart_L1_width3"        value="8.0*mm"/>
            <constant name="VTXOB_TerminalPart_L1_length3"        value="8.0*mm"/>
            <constant name="VTXOB_TerminalPart_L1_thickness3"        value="231.848*mm*mm*mm/VTXOB_TerminalPart_L1_width3/VTXOB_TerminalPart_L1_length3"/>
                
            
            <!-- Proxy for terminal part in VTXOB made out of PEEK, used in outer tracker barrel -->
            <constant name="VTXOB_TerminalPart_L2_width1"        value="(36.0*mm+23.787*mm)/2."/>
            <constant name="VTXOB_TerminalPart_L2_length1"        value="7.0*mm"/>
            <constant name="VTXOB_TerminalPart_L2_thickness1"        value="1162.157*mm*mm*mm/VTXOB_TerminalPart_L2_width1/VTXOB_TerminalPart_L2_length1"/>

            <constant name="VTXOB_TerminalPart_L2_width2"        value="(23.787*mm+18.381*mm)/2."/>
            <constant name="VTXOB_TerminalPart_L2_length2"        value="7.0*mm"/>
            <constant name="VTXOB_TerminalPart_L2_thickness2"        value="569.724*mm*mm*mm/VTXOB_TerminalPart_L2_width2/VTXOB_TerminalPart_L2_length2"/>
                     
            <constant name="VTXOB_TerminalPart_L2_width3"        value="8.5*mm"/>
            <constant name="VTXOB_TerminalPart_L2_length3"        value="9.25*mm"/>
            <constant name="VTXOB_TerminalPart_L2_thickness3"        value="304.345*mm*mm*mm/VTXOB_TerminalPart_L2_width3/VTXOB_TerminalPart_L2_length3"/>
        
            <constant name="VTXOB_z1_passive" value="2.0*(VTXOB_z1+VTXOB_mod_z_spacing+VTXO_hybrid_length+VTXOB_TerminalPart_L1_length1+VTXOB_TerminalPart_L1_length3)"/> 
            <constant name="VTXOB_z2_passive" value="2.0*(VTXOB_z2+VTXOB_mod_z_spacing+VTXO_hybrid_length+VTXOB_TerminalPart_L2_length1+VTXOB_TerminalPart_L2_length3)"/> 

        <!-- Vertex disks parameters -->
            <constant name="VTXD_support_thickness" value="VTXO_support_Fleece_thickness+VTXO_support_CarbonFiber_thickness+VTXO_support_PaperGraphite_thickness"/>      
            <constant name="VTXD_z1" value="VTXD_z_min"/>
            <constant name="VTXD_z2" value="609.086*mm"/>
            <constant name="VTXD_z3" value="VTXD_z_max"/>
            <constant name="VTXD_dz1" value="0.0*mm"/> <!-- This is not correct, but needed to increase it to avoid clashes of end-of-stave volumes as they are only approximated! -->
            <constant name="VTXD_dz2" value="0.0*mm"/>
            <constant name="VTXD_dz3" value="0.0*mm"/>
            <constant name="VTXD_rmin1" value="VTXD_r_min"/>
            <constant name="VTXD_rmin2" value="140.0/2.0*mm"/>
            <constant name="VTXD_rmin3" value="210.0/2.0*mm"/>
            <constant name="VTXD_phi1A" value="0.0*rad"/>
            <constant name="VTXD_phi1B" value="2.0*pi/8.0*rad"/> <!-- face B of first disk is offset by 45 degrees-->
            <constant name="VTXD_zoffset_stave" value="6.020*mm"/>
            <constant name="VTXD_zoffset_face1" value="32.621*mm"/> <!-- face B has different position in z than face A-->
            <constant name="VTXD_zoffset_face2" value="15.121*mm"/> <!-- face B has different position in z than face A-->
            <constant name="VTXD_zoffset_face3" value="15.871*mm"/> <!-- face B has different position in z than face A-->
            <constant name="VTXD_stave_dz" value="5.0*mm"/> <!-- Distance between front and back of stave (inner empty space) -->

            <constant name="VTXDModOverlap" value="-13.0*mm"/>
            <constant name="VTXD_rModOverlap" value="-6.5*mm"/>

            <constant name="VTXD_disk1_roffset_stave1A" value="0.0*mm"/>
            <constant name="VTXD_disk1_roffset_stave2A" value="VTXD_disk1_roffset_stave1A+VTXO_mod_z-4.739*mm"/>
            <constant name="VTXD_disk1_roffset_stave3A" value="VTXD_disk1_roffset_stave2A+VTXO_mod_z-6.2*mm"/>
            <constant name="VTXD_disk1_roffset_stave4A" value="VTXD_disk1_roffset_stave3A+VTXO_mod_z-6.2*mm"/>
            <constant name="VTXD_disk1_roffset_stave5A" value="VTXD_disk1_roffset_stave4A+VTXO_mod_z-6.5*mm"/>
            <constant name="VTXD_disk1_roffset_stave6A" value="VTXD_disk1_roffset_stave5A+VTXO_mod_z-9.305*mm"/>
            <constant name="VTXD_disk1_roffset_stave7A" value="VTXD_disk1_roffset_stave6A+VTXO_mod_z-12.757*mm"/>

            <constant name="VTXD_disk1_roffset_stave1B" value="0.0*mm"/>
            <constant name="VTXD_disk1_roffset_stave2B" value="VTXD_disk1_roffset_stave1B+VTXO_mod_z-5.898*mm"/>
            <constant name="VTXD_disk1_roffset_stave3B" value="VTXD_disk1_roffset_stave2B+VTXO_mod_z-6.448*mm"/>
            <constant name="VTXD_disk1_roffset_stave4B" value="VTXD_disk1_roffset_stave3B+VTXO_mod_z-5.788*mm"/>
            <constant name="VTXD_disk1_roffset_stave5B" value="VTXD_disk1_roffset_stave4B+VTXO_mod_z-6.5*mm"/>
            <constant name="VTXD_disk1_roffset_stave6B" value="VTXD_disk1_roffset_stave5B+VTXO_mod_z-8.49*mm"/>
            <constant name="VTXD_disk1_roffset_stave7B" value="VTXD_disk1_roffset_stave6B+VTXO_mod_z-12.375*mm"/>

            <constant name="VTXD_disk2_roffset_stave1" value="0.0*mm"/>
            <constant name="VTXD_disk2_roffset_stave2" value="VTXD_disk2_roffset_stave1+VTXO_mod_z-4.0*mm"/>
            <constant name="VTXD_disk2_roffset_stave3" value="VTXD_disk2_roffset_stave2+VTXO_mod_z-4.0*mm"/>
            <constant name="VTXD_disk2_roffset_stave4" value="VTXD_disk2_roffset_stave3+VTXO_mod_z-4.508*mm"/>
            <constant name="VTXD_disk2_roffset_stave5" value="VTXD_disk2_roffset_stave4+VTXO_mod_z-5.0*mm"/>
            <constant name="VTXD_disk2_roffset_stave6" value="VTXD_disk2_roffset_stave5+VTXO_mod_z-11.095*mm"/>

            <constant name="VTXD_disk3_roffset_stave1A" value="0.0*mm"/>
            <constant name="VTXD_disk3_roffset_stave2A" value="VTXD_disk3_roffset_stave1A+VTXO_mod_z-5.5*mm"/>
            <constant name="VTXD_disk3_roffset_stave3A" value="VTXD_disk3_roffset_stave2A+VTXO_mod_z-5.5*mm"/>
            <constant name="VTXD_disk3_roffset_stave4A" value="VTXD_disk3_roffset_stave3A+VTXO_mod_z-6.0*mm"/>
            <constant name="VTXD_disk3_roffset_stave5A" value="VTXD_disk3_roffset_stave4A+VTXO_mod_z-6.0*mm"/>

            <constant name="VTXD_disk3_roffset_stave1B" value="0.0*mm"/>
            <constant name="VTXD_disk3_roffset_stave2B" value="VTXD_disk3_roffset_stave1B+VTXO_mod_z-6.0*mm"/>
            <constant name="VTXD_disk3_roffset_stave3B" value="VTXD_disk3_roffset_stave2B+VTXO_mod_z-6.0*mm"/>
            <constant name="VTXD_disk3_roffset_stave4B" value="VTXD_disk3_roffset_stave3B+VTXO_mod_z-6.0*mm"/>
            <constant name="VTXD_disk3_roffset_stave5B" value="VTXD_disk3_roffset_stave4B+VTXO_mod_z-5.0*mm"/>

            <constant name="VTXD_disk1_zoffset_stave1A_1" value="0.0*mm"/>
            <constant name="VTXD_disk1_zoffset_stave2A_1" value="7.0*mm"/>
            <constant name="VTXD_disk1_zoffset_stave3A_1" value="14.0*mm"/>
            <constant name="VTXD_disk1_zoffset_stave4A_1" value="7.0*mm"/>
            <constant name="VTXD_disk1_zoffset_stave5A_1" value="13.5*mm"/>
            <constant name="VTXD_disk1_zoffset_stave6A_1" value="7.5*mm"/>
            <constant name="VTXD_disk1_zoffset_stave7A_1" value="-5.0*mm"/>

            <constant name="VTXD_disk1_zoffset_stave1A_2" value="0.0*mm"/>
            <constant name="VTXD_disk1_zoffset_stave2A_2" value="-6.48*mm"/>
            <constant name="VTXD_disk1_zoffset_stave3A_2" value="0.5*mm"/>
            <constant name="VTXD_disk1_zoffset_stave4A_2" value="-6.5*mm"/>
            <constant name="VTXD_disk1_zoffset_stave5A_2" value="0.0*mm"/>
            <constant name="VTXD_disk1_zoffset_stave6A_2" value="-6.0*mm"/>
            <constant name="VTXD_disk1_zoffset_stave7A_2" value="-18.5*mm"/>


            <constant name="VTXD_disk1_zoffset_stave1B_1" value="0.0*mm"/>
            <constant name="VTXD_disk1_zoffset_stave2B_1" value="6.02*mm"/>
            <constant name="VTXD_disk1_zoffset_stave3B_1" value="-0.5*mm"/>
            <constant name="VTXD_disk1_zoffset_stave4B_1" value="6.5*mm"/>
            <constant name="VTXD_disk1_zoffset_stave5B_1" value="0.5*mm"/>
            <constant name="VTXD_disk1_zoffset_stave6B_1" value="-6.0*mm"/>
            <constant name="VTXD_disk1_zoffset_stave7B_1" value="-12.5*mm"/>

            <constant name="VTXD_disk1_zoffset_stave1B_2" value="0.0*mm"/>
            <constant name="VTXD_disk1_zoffset_stave2B_2" value="14.52*mm"/>
            <constant name="VTXD_disk1_zoffset_stave3B_2" value="8.0*mm"/>
            <constant name="VTXD_disk1_zoffset_stave4B_2" value="15.0*mm"/>
            <constant name="VTXD_disk1_zoffset_stave5B_2" value="8.0*mm"/>
            <constant name="VTXD_disk1_zoffset_stave6B_2" value="2.0*mm"/>
            <constant name="VTXD_disk1_zoffset_stave7B_2" value="-4.0*mm"/>

            <constant name="VTXD_disk2_zoffset_stave1" value="0.0*mm"/>
            <constant name="VTXD_disk2_zoffset_stave2" value="-7.52*mm"/>
            <constant name="VTXD_disk2_zoffset_stave3" value="1.02*mm"/>
            <constant name="VTXD_disk2_zoffset_stave4" value="-7.52*mm"/>
            <constant name="VTXD_disk2_zoffset_stave5" value="1.02*mm"/>
            <constant name="VTXD_disk2_zoffset_stave6" value="-7.02*mm"/>

            <constant name="VTXD_disk3_zoffset_stave1A" value="0.0*mm"/>
            <constant name="VTXD_disk3_zoffset_stave2A" value="-11.904*mm"/>
            <constant name="VTXD_disk3_zoffset_stave3A" value="0.5*mm"/>
            <constant name="VTXD_disk3_zoffset_stave4A" value="-7.0*mm"/>
            <constant name="VTXD_disk3_zoffset_stave5A" value="0.0*mm"/>

            <constant name="VTXD_disk3_zoffset_stave1B" value="0.0*mm"/>
            <constant name="VTXD_disk3_zoffset_stave2B" value="7.25*mm"/>
            <constant name="VTXD_disk3_zoffset_stave3B" value="0.75*mm"/>
            <constant name="VTXD_disk3_zoffset_stave4B" value="7.25*mm"/>
            <constant name="VTXD_disk3_zoffset_stave5B" value="0.25*mm"/>

            <constant name="VTXD_Pipe_offset" value="5.42*mm/2.0"/> 

            <!-- Terminal part of VTXD, volume: Is between ~1700 and 4000 mm^3, depending on where on the stave. Let's assume 2500 mm^3. This is modelled by one volumes with thickness of 6.84 mm and length of 9 mm so that 6.84*9*40.6=2500 mm^3. In principle some of this material should be between the front and back of the stave, but in this simplified description it is just on the sides of the stave -->
            <constant name="VTXD_TerminalPart_length" value="9.0*mm"/> 
            <constant name="VTXD_Terminal_thickness" value="5.84*mm"/> 

            <constant name="VTXOB_half_length" value="VTXOB_z2+VTXO_hybrid_length+VTXOB_mod_z_spacing+VTXOB_TerminalPart_L1_length2+VTXOB_TerminalPart_L1_length3"/>
    </define>

    <define>
            <constant name="M_PI" value="3.14159265359"/>

        <!-- Vertex inner barrel (VTXIB), using curved MAPS! -->
            <constant name="RSU_z" value="21.666*mm"/> <!-- Length of a single RSU in z -->
            <constant name="RSU_rphi_periphery" value="1.0525*mm"/> <!-- Assume 5% periphery -->
            <constant name="RSU_rphi_sensitive" value="21.02*mm-RSU_rphi_periphery"/> <!-- Length of a single RSU in rphi -->
            <constant name="RSU_rphi" value="RSU_rphi_sensitive+RSU_rphi_periphery"/> <!-- Length of a single RSU in rphi -->

        <!-- Vertex inner barrel parameters -->    
            <constant name="VTXIB_curved_gap_rphi" value="1.0*mm"/>
            <constant name="VTXIB_curved_gap_z3" value="3.0*mm"/>
            <constant name="VTXIB_curved_gap_z4" value="3.0*mm"/>

            <constant name="Beampipe_outer_r" value="CentralBeamPipe_rmax+BeamPipeWidth"/>

            <constant name="VTXIB_curved_r1" value="(RSU_rphi*4.+2*VTXIB_curved_gap_rphi)/(2.0*M_PI)"/> <!-- Assume 2 mm of gap between the two sensors, so r=(18.516*4.+2*2)/(2.0*pi)=12.424 mm-->
            <constant name="VTXIB_curved_r2" value="(RSU_rphi*6.+2*VTXIB_curved_gap_rphi)/(2.0*M_PI)"/> <!-- Assume 2 mm of gap between the two sensors -->
            <constant name="VTXIB_curved_r3" value="(RSU_rphi*8.+2*VTXIB_curved_gap_rphi)/(2.0*M_PI)"/> <!-- Assume 2 mm of gap between the two sensors -->
            <constant name="VTXIB_curved_r4" value="(RSU_rphi*10.+2*VTXIB_curved_gap_rphi)/(2.0*M_PI)"/> <!-- Assume 2 mm of gap between the two sensors -->
            <constant name="VTXIB_curved_r_outer" value="40.0*mm"/>     <!-- End of vertex inner barrel -->


            <constant name="VTXIB_curved_nModules1" value="10"/>
            <constant name="VTXIB_curved_nModules2" value="12"/>
            <constant name="VTXIB_curved_nModules3" value="9"/>
            <constant name="VTXIB_curved_nModules4" value="9"/>

            <constant name="VTXIB_curved_z1" value="(VTXIB_curved_nModules1*RSU_z)/2."/> <!-- 10*21.666 = 216.66*mm-->
            <constant name="VTXIB_curved_z2" value="(VTXIB_curved_nModules2*RSU_z)/2."/> <!-- 12*21.666 = 259.992*mm-->
            <constant name="VTXIB_curved_z3" value="(VTXIB_curved_nModules3*RSU_z)/2."/> <!-- 9*21.666 = 194.994*mm-->
            <constant name="VTXIB_curved_z4" value="(VTXIB_curved_nModules4*RSU_z)/2."/> <!-- 9*21.666 = 194.994*mm-->

            <constant name="VTXIB_curved_phi0_1" value="0.0*deg"/>
            <constant name="VTXIB_curved_phi0_2" value="8.0*deg"/>
            <constant name="VTXIB_curved_phi0_3" value="-8.0*deg"/>
            <constant name="VTXIB_curved_phi0_4" value="0.0*deg"/>

            <constant name="VTXIB_curved_ring1_phi_offset" value="2*M_PI*0.5*RSU_rphi/(4.*RSU_rphi+2.*VTXIB_curved_gap_rphi)"/>
            <constant name="VTXIB_curved_ring2_phi_offset" value="2*M_PI*1.0*RSU_rphi/(6.*RSU_rphi+2.*VTXIB_curved_gap_rphi)"/>
            <constant name="VTXIB_curved_ring3_phi_offset" value="2*M_PI*1.5*RSU_rphi/(8.*RSU_rphi+2.*VTXIB_curved_gap_rphi)"/>
            <constant name="VTXIB_curved_ring4_phi_offset" value="2*M_PI*2.0*RSU_rphi/(10.*RSU_rphi+2.*VTXIB_curved_gap_rphi)"/>

            <constant name="VTXIB_curved_sensitive_thickness"   value="50e-03*mm"/>

            <constant name="VTXIB_curved_flex_Aluminium_thickness" value="0.050*mm"/>
            <constant name="VTXIB_curved_flex_Kapton_thickness"    value="0.200*mm"/>
            <constant name="VTXIB_curved_flex_length"              value="20.0*mm"/>

            <!-- -->

            <!-- Properties of curved vertex support structures -->
            <constant name="VTXIB_curved_longeron1_width" value="3.0*mm"/> <!-- width of support structure along z -->
            <constant name="VTXIB_curved_longeron2_width" value="4.0*mm"/> <!-- width of support structure along z -->
            <constant name="VTXIB_curved_longeron3_width" value="5.0*mm"/> <!-- width of support structure along z -->
            <constant name="VTXIB_curved_longeron4_width" value="6.0*mm"/> <!-- width of support structure along z -->

            <constant name="VTXIB_curved_longeron1_phi_offset" value="(0.5*RSU_rphi+VTXIB_curved_longeron1_width/4.)/(4.*RSU_rphi+2.*VTXIB_curved_gap_rphi)*360.0*deg"/>
            <constant name="VTXIB_curved_longeron2_phi_offset" value="(0.5*RSU_rphi+VTXIB_curved_longeron2_width/4.)/(6.*RSU_rphi+2.*VTXIB_curved_gap_rphi)*360.0*deg"/>
            <constant name="VTXIB_curved_longeron3_phi_offset" value="(0.5*RSU_rphi+VTXIB_curved_longeron3_width/4.)/(8.*RSU_rphi+2.*VTXIB_curved_gap_rphi)*360.0*deg"/>
            <constant name="VTXIB_curved_longeron4_phi_offset" value="(0.5*RSU_rphi+VTXIB_curved_longeron4_width/4.)/(10.*RSU_rphi+2.*VTXIB_curved_gap_rphi)*360.0*deg"/>

            <constant name="VTXIB_curved_support_ring_length" value="3.5*mm"/>
            <constant name="VTXIB_curved_ring_zoffset" value="-1.5*mm"/>
            <constant name="VTXIB_curved_intermed_ring1_width" value="(RSU_rphi+0.5*VTXIB_curved_gap_rphi)-VTXIB_curved_longeron1_width"/>
            <constant name="VTXIB_curved_intermed_ring2_width" value="(1.5*RSU_rphi+0.5*VTXIB_curved_gap_rphi)-VTXIB_curved_longeron2_width"/>
            <constant name="VTXIB_curved_intermed_ring3_width" value="(RSU_rphi+0.5*VTXIB_curved_gap_rphi)-VTXIB_curved_longeron3_width"/>
            <constant name="VTXIB_curved_intermed_ring4_width" value="(RSU_rphi+0.5*VTXIB_curved_gap_rphi)-VTXIB_curved_longeron4_width"/>
            
            <!-- Properties of structures at sides of sensor -->
            <constant name="VTXIB_curved_endcap1_length" value="3.0*mm"/>
            <constant name="VTXIB_curved_endcap2_length" value="3.0*mm"/>
            <constant name="VTXIB_curved_endcap3_length_center" value="1.5*mm"/>
            <constant name="VTXIB_curved_endcap3_length_side" value="4.5*mm"/>
            <constant name="VTXIB_curved_endcap4_length_center" value="3.0*mm"/>
            <constant name="VTXIB_curved_endcap4_length_side" value="3.0*mm"/>

<!--            <constant name="VTXIB_curved_curved_tolerance_r" value="0.1*mm"/> <!~~ To get rid of overlaps when visualising the geometry, SET TO 0 FOR OTHER PURPOSES! ~~> -->            
            <constant name="VTXIB_curved_curved_tolerance_r" value="0.0*mm"/>

           <constant name="VTXIB_curved_half_length" value="2.0*VTXIB_curved_z4+VTXIB_curved_endcap4_length_center+VTXIB_curved_endcap4_length_side+VTXIB_curved_flex_length+VTXIB_curved_gap_z4"/>

            <constant name="VTXIB_z1_passive" value="2.*VTXIB_curved_z1+2.0*VTXIB_curved_endcap1_length+2.0*VTXIB_curved_flex_length"/> 
            <constant name="VTXIB_z2_passive" value="2.*VTXIB_curved_z2+2.0*VTXIB_curved_endcap2_length+2.0*VTXIB_curved_flex_length"/> 
            <constant name="VTXIB_z3_passive" value="4.*VTXIB_curved_z3+2.*VTXIB_curved_endcap3_length_center+2.*VTXIB_curved_endcap3_length_side+2.0*VTXIB_curved_flex_length+VTXIB_curved_gap_z3"/> 
            <constant name="VTXIB_z4_passive" value="4.*VTXIB_curved_z4+2.*VTXIB_curved_endcap4_length_center+2.*VTXIB_curved_endcap4_length_side+2.0*VTXIB_curved_flex_length+VTXIB_curved_gap_z4"/> 

    </define>


    <!--  Definition of the readout segmentation/definition  -->
    <readouts>
        <readout name="VTXIBCollection">
            <segmentation type="CartesianGridYZ" grid_size_y="0.025*mm" grid_size_z="0.025*mm"/>  <!-- Pixels of 25x25 µm for first three layers, other two are 50x150 µm (not correctly implemented currently!)-->
            <id>${GlobalTrackerReadoutID},y:32:-16,z:-16</id>
        </readout>  
        <readout name="VTXDCollection">
            <segmentation type="CartesianGridXY" grid_size_x="0.050*mm" grid_size_y="0.150*mm"/>  <!-- Pixels of 50x150 µm in r-phi x r -->
            <id>${GlobalTrackerReadoutID},x:32:-16,y:-16</id>
        </readout>
    </readouts>

   <detectors>
 
    <!-- Vertex inner barrel -->
        <detector name="VTXIB" type="VertexCylindrical_o1_v01" vis="VXDVis" id="DetID_VXD_IB" readout="VTXIBCollection"  region="VTXIBRegion">
          <!-- <envelope vis="VXDVis">
                <shape type="BooleanShape" operation="Subtraction" material="Air">
                    <shape type="BooleanShape" operation="Subtraction" material="Air">
                        <shape type="BooleanShape" operation="Union" material="Air">
                            <shape type="Tube" rmin="VTXOB_r_max_layer-VTXOB_TerminalPart_L2_thickness1-12.771*mm" rmax="VTXOB_r_max_layer+VTXOB_rmax_clearance" dz="VTXOB_z2_passive/2."/>
                            <shape type="BooleanShape" operation="Union" material="Air">
                                <shape type="Tube" rmin="VTXOB_r_min_layer-VTXOB_r_min_clearance" rmax="VTXOB_r_max_layer-VTXOB_TerminalPart_L2_thickness1-12.771*mm" dz="VTXOB_z1_passive/2."/>
                                <shape type="Tube" rmin="VTXIB_r_min_layer-VTXIB_r_min_clearance" rmax="VTXOB_r_min_layer-VTXOB_r_min_clearance" dz="VTXIB_half_length"/>
                            </shape>
                        </shape>
                        <shape type="Cone" rmin1="0" rmax1="tan(VertexClearanceTheta)*2000.0*mm" rmin2="0" rmax2="0" z="2000.0*mm/2."/>
                        <position x="0" y="0" z="-2000.0*mm/2." />
                    </shape>                            
                    <shape type="Cone" rmin1="0" rmax1="0" rmin2="0" rmax2="tan(VertexClearanceTheta)*2000.0*mm" z="2000.0*mm/2."/>
                    <position x="0" y="0" z="2000.0*mm/2." />
                </shape>
            </envelope> -->
 
             <envelope vis="VXDVis">
                <shape type="BooleanShape" operation="Union" material="Air">
                    <shape type="Tube" rmin="VTXIB_r_min_layer-VTXIB_r_min_clearance" rmax="VTXOB_r_max_layer+VTXOB_rmax_clearance" dz="VTXOB_z2_passive/2."/>
                </shape>
            </envelope>


            <!-- <envelope vis="VXDVis">
                <shape type="Assembly"/>
            </envelope> -->

            <type_flags type=" DetType_TRACKER + DetType_PIXEL + DetType_VERTEX + DetType_BARREL"/>
            
            <!-- Definition of our "stave" object that is used to build the barrel -->
            <stave name="SiVTXIBStave1">
                <!-- Sensor -->
                <sensor r="0.0*mm" thickness="VTXIB_Sensitive_Thickness" material="Silicon">
                    <component sensitive="False"    xmin="-VTXIB_mod_rphi/2.0" xmax="-VTXIB_mod_rphi/2.0 + VTXIB_mod_rphi_periphery"    ymin="-VTXIB_mod_z/2.0" ymax="+VTXIB_mod_z/2.0" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="-VTXIB_mod_rphi/2.0 + VTXIB_mod_rphi_periphery"                               xmax="VTXIB_mod_rphi/2.0" ymin="-VTXIB_mod_z/2.0" ymax="+VTXIB_mod_z/2.0" vis="SiSensitiveVis"/>
                </sensor>

                <components name="support" r="VTXIB_Sensitive_Thickness" length="VTXIB_z1">
                    <component thickness="VTXIB_Glue_Thickness" width="VTXIB_mod_rphi" offset="0.0*mm" r="0.0*mm" material="GlueEcobond45" vis="SupportVis"/>
                    <component thickness="VTXIB_Support_Thickness" width="VTXIB_Support_width" offset="0.0*mm" r="VTXIB_Glue_Thickness" material="CarbonFiberVtx" vis="GlueVis"/>
                    <component thickness="VTXIB_L1_Holder_Thickness"  width="VTXIB_L1_Holder_Rohacell_rphi" offset="0.0*mm" r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="RohacellVtx66D" vis="RohacellVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L1_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" offset="-VTXIB_L1_Holder_Rohacell_rphi/2.0-VTXIB_Holder_CarbonFiber_rphi/2.0" r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="CarbonFiberVtx66D" vis="SupportVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L1_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" offset="VTXIB_L1_Holder_Rohacell_rphi/2.0+VTXIB_Holder_CarbonFiber_rphi/2.0"  r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="CarbonFiberVtx66D" vis="SupportVis"/> <!-- Holder structure -->
                </components>

                <components name="flexes" r="VTXIB_Sensitive_Thickness+VTXIB_Glue_Thickness+VTXIB_Support_Thickness" length="VTXIB_z1">
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" r="0.0*mm" offset="VTXIB_flex_offset" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" r="VTXIB_flex_Kapton_thickness" offset="VTXIB_flex_offset" material="Al" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" r="0.0*mm" offset="-VTXIB_flex_offset" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" r="VTXIB_flex_Kapton_thickness" offset="-VTXIB_flex_offset" material="Al" vis="CableVis"/>
                </components>

                <!-- End of stave structures -->
                <end_z name="endOfStave" r="0.0*mm">
                    <!-- Hybrid -->
                    <component thickness="VTXIB_endOfStave_Thickness" width="VTXIB_mod_rphi" length="VTXIB_hybrid_z" dz="VTXIB_mod_z_spacing" r="0.0*mm" material="PCB" vis="HybridVis"/>

                    <!-- Rest of flexes -->
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+0.0*mm" offset="VTXIB_flex_offset" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+VTXIB_flex_Kapton_thickness" offset="VTXIB_flex_offset" material="Al" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+0.0*mm" offset="-VTXIB_flex_offset" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+VTXIB_flex_Kapton_thickness" offset="-VTXIB_flex_offset" material="Al" vis="CableVis"/>

                    <!-- Rest of holder -->
                    <component thickness="VTXIB_L1_Holder_Thickness"  width="VTXIB_L1_Holder_Rohacell_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="0.0*mm"                                                                 r="VTXIB_endOfStave_Thickness" material="RohacellVtx66D"       vis="RohacellVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L1_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="-VTXIB_L1_Holder_Rohacell_rphi/2.0-VTXIB_Holder_CarbonFiber_rphi/2.0"   r="VTXIB_endOfStave_Thickness" material="CarbonFiberVtx66D"    vis="SupportVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L1_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="VTXIB_L1_Holder_Rohacell_rphi/2.0+VTXIB_Holder_CarbonFiber_rphi/2.0"    r="VTXIB_endOfStave_Thickness" material="CarbonFiberVtx66D"    vis="SupportVis"/> <!-- Holder structure -->
                </end_z>
            </stave>

            <!-- Definition of our "stave" object that is used to build the barrel, this time for layer 2 -->
            <stave name="SiVTXIBStave2">
                <!-- Sensor -->
                <sensor r="0.0*mm" thickness="VTXIB_Sensitive_Thickness" material="Silicon">
                    <component sensitive="False"    xmin="-VTXIB_mod_rphi/2.0+VTXIB_mod_rphi_sensitive" xmax="VTXIB_mod_rphi/2.0"                                       ymin="-VTXIB_mod_z/2.0" ymax="+VTXIB_mod_z/2.0" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="-VTXIB_mod_rphi/2.0"                                      xmax="-VTXIB_mod_rphi/2.0+VTXIB_mod_rphi_sensitive" ymin="-VTXIB_mod_z/2.0" ymax="+VTXIB_mod_z/2.0" vis="SiSensitiveVis"/>
                </sensor>

                <components name="support" r="VTXIB_Sensitive_Thickness" length="VTXIB_z2">
                    <component thickness="VTXIB_Glue_Thickness" width="VTXIB_mod_rphi" offset="0.0*mm" r="0.0*mm" material="GlueEcobond45" vis="SupportVis"/>
                    <component thickness="VTXIB_Support_Thickness" width="VTXIB_Support_width" offset="0.0*mm" r="VTXIB_Glue_Thickness" material="CarbonFiberVtx" vis="SupportVis"/>
                    <component thickness="VTXIB_L2_Holder_Thickness"  width="VTXIB_L2_Holder_Rohacell_rphi" offset="0.0*mm" r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="RohacellVtx66D" vis="RohacellVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L2_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" offset="-VTXIB_L2_Holder_Rohacell_rphi/2.0-VTXIB_Holder_CarbonFiber_rphi/2.0" r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="CarbonFiberVtx66D" vis="SupportVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L2_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" offset="VTXIB_L2_Holder_Rohacell_rphi/2.0+VTXIB_Holder_CarbonFiber_rphi/2.0"  r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="CarbonFiberVtx66D" vis="SupportVis"/> <!-- Holder structure -->
                </components>

                <components name="flexes" r="VTXIB_Sensitive_Thickness+VTXIB_Glue_Thickness+VTXIB_Support_Thickness" length="VTXIB_z2">
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" r="0.0*mm" offset="VTXIB_flex_offset" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" r="VTXIB_flex_Kapton_thickness" offset="VTXIB_flex_offset" material="Al" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" r="0.0*mm" offset="-VTXIB_flex_offset" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" r="VTXIB_flex_Kapton_thickness" offset="-VTXIB_flex_offset" material="Al" vis="CableVis"/>
                </components>

                <!-- End of stave structures -->
                <end_z name="endOfStave" r="0.0*mm">
                    <!-- Hybrid -->
                    <component thickness="VTXIB_endOfStave_Thickness" width="VTXIB_mod_rphi" length="VTXIB_hybrid_z" dz="VTXIB_mod_z_spacing" r="0.0*mm" material="PCB" vis="HybridVis"/>

                    <!-- Rest of flexes -->
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+0.0*mm"                       offset="VTXIB_flex_offset"  material="KaptonVtx"    vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+VTXIB_flex_Kapton_thickness"  offset="VTXIB_flex_offset"  material="Al"           vis="CableVis"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+0.0*mm"                       offset="-VTXIB_flex_offset" material="KaptonVtx"    vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+VTXIB_flex_Kapton_thickness"  offset="-VTXIB_flex_offset" material="Al"           vis="CableVis"/>

                    <!-- Rest of holder -->
                    <component thickness="VTXIB_L2_Holder_Thickness"  width="VTXIB_L2_Holder_Rohacell_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="0.0*mm"                                                                 r="VTXIB_endOfStave_Thickness" material="RohacellVtx66D"       vis="RohacellVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L2_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="-VTXIB_L2_Holder_Rohacell_rphi/2.0-VTXIB_Holder_CarbonFiber_rphi/2.0"   r="VTXIB_endOfStave_Thickness" material="CarbonFiberVtx66D"    vis="SupportVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L2_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="VTXIB_L2_Holder_Rohacell_rphi/2.0+VTXIB_Holder_CarbonFiber_rphi/2.0"    r="VTXIB_endOfStave_Thickness" material="CarbonFiberVtx66D"    vis="SupportVis"/> <!-- Holder structure -->
                </end_z>
            </stave>

            <!-- Definition of our "stave" object that is used to build the barrel. There are two different versions for layer 3 as they are mirrored in x-y and are at a different r -->
            <stave name="SiVTXIBStave3">
                <!-- Sensor -->
                <sensor r="0.0*mm" thickness="VTXIB_Sensitive_Thickness" material="Silicon">
                    <component sensitive="False"    xmin="-VTXIB_mod_rphi/2.0+VTXIB_mod_rphi_sensitive" xmax="VTXIB_mod_rphi/2.0"                                       ymin="-VTXIB_mod_z/2.0" ymax="+VTXIB_mod_z/2.0" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="-VTXIB_mod_rphi/2.0"                                      xmax="-VTXIB_mod_rphi/2.0+VTXIB_mod_rphi_sensitive" ymin="-VTXIB_mod_z/2.0" ymax="+VTXIB_mod_z/2.0" vis="SiSensitiveVis"/>
                </sensor>

                <components name="support" r="VTXIB_Sensitive_Thickness" length="VTXIB_z3">
                    <component thickness="VTXIB_Glue_Thickness" width="VTXIB_mod_rphi" offset="0.0*mm" r="0.0*mm" material="GlueEcobond45" vis="SupportVis"/>
                    <component thickness="VTXIB_Support_Thickness" width="VTXIB_Support_width" offset="0.0*mm" r="VTXIB_Glue_Thickness" material="CarbonFiberVtx" vis="SupportVis"/> 
                    <component thickness="VTXIB_L3_Holder_Thickness"  width="VTXIB_L3_Holder_Rohacell_rphi" offset="0.0*mm" r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="RohacellVtx66D" vis="RohacellVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L3_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" offset="-VTXIB_L3_Holder_Rohacell_rphi/2.0-VTXIB_Holder_CarbonFiber_rphi/2.0" r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="CarbonFiberVtx66D" vis="SupportVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L3_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" offset="VTXIB_L3_Holder_Rohacell_rphi/2.0+VTXIB_Holder_CarbonFiber_rphi/2.0"  r="VTXIB_Glue_Thickness+VTXIB_Support_Thickness" material="CarbonFiberVtx66D" vis="SupportVis"/> <!-- Holder structure -->
                </components>

                <components name="flexes" r="VTXIB_Sensitive_Thickness+VTXIB_Glue_Thickness+VTXIB_Support_Thickness" length="VTXIB_z3">
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" r="0.0*mm" offset="VTXIB_flex_offset" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" r="VTXIB_flex_Kapton_thickness" offset="VTXIB_flex_offset" material="Al" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"       width="VTXIB_flex_width" r="0.0*mm" offset="-VTXIB_flex_offset" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"    width="VTXIB_flex_width" r="VTXIB_flex_Kapton_thickness" offset="-VTXIB_flex_offset" material="Al" vis="CableVis"/>
                </components>

                <!-- End of stave structures -->
                <end_z name="endOfStave" r="0.0*mm">
                    <!-- Hybrid -->
                    <component thickness="VTXIB_endOfStave_Thickness" width="VTXIB_mod_rphi" length="VTXIB_hybrid_z" dz="VTXIB_mod_z_spacing" r="0.0*mm" material="PCB" vis="HybridVis"/>

                    <!-- Rest of flexes -->
                    <component thickness="VTXIB_flex_Kapton_thickness"      width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+0.0*mm"                       offset="VTXIB_flex_offset"  material="KaptonVtx"    vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"   width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+VTXIB_flex_Kapton_thickness"  offset="VTXIB_flex_offset"  material="Al"           vis="CableVis"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"      width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+0.0*mm"                       offset="-VTXIB_flex_offset" material="KaptonVtx"    vis="CableVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"   width="VTXIB_flex_width" length="7.0*mm" r="VTXIB_endOfStave_Thickness+VTXIB_flex_Kapton_thickness"  offset="-VTXIB_flex_offset" material="Al"           vis="CableVis"/>

                    <!-- Rest of holder -->
                    <component thickness="VTXIB_L3_Holder_Thickness"  width="VTXIB_L3_Holder_Rohacell_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="0.0*mm"                                                                 r="VTXIB_endOfStave_Thickness" material="RohacellVtx66D"       vis="RohacellVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L3_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="-VTXIB_L3_Holder_Rohacell_rphi/2.0-VTXIB_Holder_CarbonFiber_rphi/2.0"   r="VTXIB_endOfStave_Thickness" material="CarbonFiberVtx66D"    vis="SupportVis"/> <!-- Holder structure -->
                    <component thickness="VTXIB_L3_Holder_Thickness"  width="VTXIB_Holder_CarbonFiber_rphi" length="VTXIB_hybrid_z+VTXIB_mod_z_spacing" offset="VTXIB_L3_Holder_Rohacell_rphi/2.0+VTXIB_Holder_CarbonFiber_rphi/2.0"    r="VTXIB_endOfStave_Thickness" material="CarbonFiberVtx66D"    vis="SupportVis"/> <!-- Holder structure -->
                </end_z>
            </stave>


            <!-- Curved vertex -->
            <stave name="SiVTXIBStave1Curved" r="VTXIB_curved_r1">
                <!-- Sensor -->
                <sensor thickness="VTXIB_curved_sensitive_thickness" material="Silicon">
                    <!-- First segment -->
                    <component sensitive="False"    xmin="0.0*RSU_rphi-RSU_rphi/2."                     xmax="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="0.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <!-- Second segment -->
                    <component sensitive="False"    xmin="1.0*RSU_rphi-RSU_rphi/2."                     xmax="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="1.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>
                </sensor>

                <!-- Longerons -->
                <components name="support_longeron" r="VTXIB_curved_sensitive_thickness+VTXIB_curved_curved_tolerance_r" length="VTXIB_curved_z1+VTXIB_curved_endcap1_length-VTXIB_curved_support_ring_length+VTXIB_curved_ring_zoffset">
                    <component thickness="VTXIB_curved_r2-VTXIB_curved_r1-2.0*VTXIB_curved_curved_tolerance_r" width="VTXIB_curved_longeron1_width" offset="0.0*mm" phi_offset="90.0*deg-VTXIB_curved_longeron1_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- first longeron -->
                    <component thickness="VTXIB_curved_r2-VTXIB_curved_r1-2.0*VTXIB_curved_curved_tolerance_r" width="VTXIB_curved_longeron1_width" offset="0.0*mm" phi_offset="0.0*deg-VTXIB_curved_longeron1_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- second longeron -->
                </components>

                <end_z name="endcaps_flexes">
                    <!-- Readout electronics on wafer -->
                    <component thickness="VTXIB_curved_sensitive_thickness" width="2.0*RSU_rphi" length="VTXIB_curved_endcap1_length" phi_offset="VTXIB_curved_ring1_phi_offset" isCurved="true" material="Silicon" vis="SiPeripheryVis"/>
    
                    <!-- Readout flexes -->
                    <component thickness="VTXIB_curved_flex_Aluminium_thickness"   width="2.0*RSU_rphi" length="VTXIB_curved_flex_length" phi_offset="VTXIB_curved_ring1_phi_offset" isCurved="true" vis="CableVis" dz="VTXIB_curved_endcap1_length" material="Al"/>
                    <component thickness="VTXIB_curved_flex_Kapton_thickness"      width="2.0*RSU_rphi" length="VTXIB_curved_flex_length" phi_offset="VTXIB_curved_ring1_phi_offset" isCurved="true" vis="CableVis" dz="VTXIB_curved_endcap1_length" material="Kapton" r="VTXIB_curved_flex_Aluminium_thickness+VTXIB_curved_curved_tolerance_r"/>
                </end_z>

                <!-- Support rings -->
                <end_z name="support_rings" r="VTXIB_curved_sensitive_thickness+VTXIB_curved_curved_tolerance_r">
                    <component thickness="VTXIB_curved_r2-VTXIB_curved_r1-VTXIB_curved_sensitive_thickness-2.0*VTXIB_curved_curved_tolerance_r" width="M_PI*(VTXIB_curved_r1+VTXIB_curved_sensitive_thickness)" length="VTXIB_curved_support_ring_length" phi_offset="VTXIB_curved_ring1_phi_offset" isCurved="true" material="CarbonFoam" vis="CarbonFoam" dz="+VTXIB_curved_endcap1_length-VTXIB_curved_support_ring_length+VTXIB_curved_ring_zoffset"/>
                </end_z>
            </stave>

            <stave name="SiVTXIBStave2Curved" r="VTXIB_curved_r2">
                <sensor thickness="VTXIB_curved_sensitive_thickness" material="Silicon">
                    <!-- First segment -->
                    <component sensitive="False"    xmin="0.0*RSU_rphi-RSU_rphi/2."                     xmax="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="0.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <!-- Second segment -->
                    <component sensitive="False"    xmin="1.0*RSU_rphi-RSU_rphi/2."                     xmax="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="1.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <!-- Third segment -->
                    <component sensitive="False"    xmin="2.0*RSU_rphi-RSU_rphi/2."                     xmax="2.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="2.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="2.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>
                </sensor>

                <components name="support_longeron" r="VTXIB_curved_sensitive_thickness+VTXIB_curved_curved_tolerance_r" length="VTXIB_curved_z2+VTXIB_curved_endcap2_length-VTXIB_curved_support_ring_length+VTXIB_curved_ring_zoffset">
                    <component thickness="VTXIB_curved_r3-VTXIB_curved_r2-2.0*VTXIB_curved_curved_tolerance_r" width="VTXIB_curved_longeron2_width" offset="0.0*mm" phi_offset="90.0*deg-VTXIB_curved_longeron2_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- first longeron -->
                    <component thickness="VTXIB_curved_r3-VTXIB_curved_r2-2.0*VTXIB_curved_curved_tolerance_r" width="VTXIB_curved_longeron2_width" offset="0.0*mm" phi_offset="0.0*deg-VTXIB_curved_longeron2_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- second longeron -->
                </components> 
                
                <end_z name="endcaps_flexes">
                    <component thickness="VTXIB_curved_sensitive_thickness"        width="3.0*RSU_rphi" length="VTXIB_curved_endcap2_length" phi_offset="VTXIB_curved_ring2_phi_offset" isCurved="true" material="Silicon" vis="SiPeripheryVis"/>
                    <component thickness="VTXIB_curved_flex_Aluminium_thickness"   width="3.0*RSU_rphi" length="VTXIB_curved_flex_length" phi_offset="VTXIB_curved_ring2_phi_offset" isCurved="true" material="Al" vis="CableVis" dz="VTXIB_curved_endcap2_length"/>
                    <component thickness="VTXIB_curved_flex_Kapton_thickness"      width="3.0*RSU_rphi" length="VTXIB_curved_flex_length" phi_offset="VTXIB_curved_ring2_phi_offset" isCurved="true" material="Kapton" vis="CableVis" dz="VTXIB_curved_endcap2_length" r="VTXIB_curved_flex_Aluminium_thickness+VTXIB_curved_curved_tolerance_r"/>
                </end_z>

                <end_z name="support_rings" r="VTXIB_curved_sensitive_thickness+VTXIB_curved_curved_tolerance_r">
                    <!-- Sides, one per half barrel -->
                    <component thickness="VTXIB_curved_r3-VTXIB_curved_r2-VTXIB_curved_sensitive_thickness-2.0*VTXIB_curved_curved_tolerance_r" width="M_PI*(VTXIB_curved_r2+VTXIB_curved_sensitive_thickness)" length="VTXIB_curved_support_ring_length" phi_offset="VTXIB_curved_ring2_phi_offset" isCurved="true" material="CarbonFoam" vis="CarbonFoam" dz="+VTXIB_curved_endcap2_length-VTXIB_curved_support_ring_length+VTXIB_curved_ring_zoffset"/>
                </end_z>
            </stave>

            <stave name="SiVTXIBStave3Curved" r="VTXIB_curved_r3">
                <sensor thickness="VTXIB_curved_sensitive_thickness" material="Silicon">
                    <component sensitive="False"    xmin="0.0*RSU_rphi-RSU_rphi/2."                     xmax="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="0.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="1.0*RSU_rphi-RSU_rphi/2."                     xmax="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="1.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="2.0*RSU_rphi-RSU_rphi/2."                     xmax="2.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="2.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="2.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="3.0*RSU_rphi-RSU_rphi/2."                     xmax="3.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="3.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="3.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>
                </sensor>

                <components name="support_longeron" r="VTXIB_curved_sensitive_thickness+VTXIB_curved_curved_tolerance_r" length="VTXIB_curved_z3+VTXIB_curved_endcap3_length_center-VTXIB_curved_support_ring_length+VTXIB_curved_ring_zoffset">
                    <component thickness="VTXIB_curved_r4-VTXIB_curved_r3-2.0*VTXIB_curved_curved_tolerance_r" width="VTXIB_curved_longeron3_width" offset="0.0*mm" phi_offset="90.0*deg-VTXIB_curved_longeron3_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- first longeron -->
                    <component thickness="VTXIB_curved_r4-VTXIB_curved_r3-2.0*VTXIB_curved_curved_tolerance_r" width="VTXIB_curved_longeron3_width" offset="0.0*mm" phi_offset="0.0*deg-VTXIB_curved_longeron3_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- second longeron -->
                </components>

                <end_z name="endcaps_flexes">
                    <component thickness="VTXIB_curved_flex_Aluminium_thickness"   width="4.0*RSU_rphi" length="VTXIB_curved_flex_length" phi_offset="VTXIB_curved_ring3_phi_offset" isCurved="true" material="Al" vis="CableVis" dz="VTXIB_curved_endcap3_length_side" side="+1"/>
                    <component thickness="VTXIB_curved_flex_Kapton_thickness"      width="4.0*RSU_rphi" length="VTXIB_curved_flex_length" phi_offset="VTXIB_curved_ring3_phi_offset" isCurved="true" material="Kapton" vis="CableVis" dz="VTXIB_curved_endcap3_length_side" side="+1" r="VTXIB_curved_flex_Aluminium_thickness+VTXIB_curved_curved_tolerance_r"/>
                    <component thickness="VTXIB_curved_sensitive_thickness" width="4.0*RSU_rphi" length="VTXIB_curved_endcap3_length_center" phi_offset="VTXIB_curved_ring3_phi_offset" isCurved="true" material="Silicon" vis="SiPeripheryVis" side="-1"/>
                    <component thickness="VTXIB_curved_sensitive_thickness" width="4.0*RSU_rphi" length="VTXIB_curved_endcap3_length_side"   phi_offset="VTXIB_curved_ring3_phi_offset" isCurved="true" material="Silicon" vis="SiPeripheryVis" side="+1"/>
                </end_z>

                <end_z name="support_rings" r="VTXIB_curved_sensitive_thickness+VTXIB_curved_curved_tolerance_r">
                    <component thickness="VTXIB_curved_r4-VTXIB_curved_r3-VTXIB_curved_sensitive_thickness-2.0*VTXIB_curved_curved_tolerance_r" width="M_PI*(VTXIB_curved_r3+VTXIB_curved_sensitive_thickness)" length="VTXIB_curved_support_ring_length" phi_offset="VTXIB_curved_ring3_phi_offset" isCurved="true" material="CarbonFoam" vis="CarbonFoam" dz="+VTXIB_curved_endcap3_length_center-VTXIB_curved_support_ring_length+VTXIB_curved_ring_zoffset"/>
                </end_z>
            </stave>


            <stave name="SiVTXIBStave4Curved" r="VTXIB_curved_r4">
                <sensor thickness="VTXIB_curved_sensitive_thickness" material="Silicon">
                    <component sensitive="False"    xmin="0.0*RSU_rphi-RSU_rphi/2."                     xmax="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="0.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="1.0*RSU_rphi-RSU_rphi/2."                     xmax="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="1.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="2.0*RSU_rphi-RSU_rphi/2."                     xmax="2.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="2.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="2.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="3.0*RSU_rphi-RSU_rphi/2."                     xmax="3.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="3.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="3.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="4.0*RSU_rphi-RSU_rphi/2."                     xmax="4.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="4.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="4.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>
                </sensor>

                <components name="support_longeron" r="VTXIB_curved_sensitive_thickness+VTXIB_curved_curved_tolerance_r" length="VTXIB_curved_z4+VTXIB_curved_endcap4_length_center-VTXIB_curved_support_ring_length+VTXIB_curved_ring_zoffset">
                    <component thickness="VTXIB_curved_r_outer-VTXIB_curved_r4" width="VTXIB_curved_longeron4_width" offset="0.0*mm" phi_offset="90.0*deg-VTXIB_curved_longeron4_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- first longeron -->
                    <component thickness="VTXIB_curved_r_outer-VTXIB_curved_r4" width="VTXIB_curved_longeron4_width" offset="0.0*mm" phi_offset="0.0*deg-VTXIB_curved_longeron4_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- second longeron -->
                </components>

                <end_z name="endcaps_flexes">
                    <component thickness="VTXIB_curved_flex_Aluminium_thickness"   width="5.0*RSU_rphi" length="VTXIB_curved_flex_length" phi_offset="VTXIB_curved_ring4_phi_offset" isCurved="true" material="Al" vis="CableVis" dz="VTXIB_curved_endcap4_length_center" side="+1"/>
                    <component thickness="VTXIB_curved_flex_Kapton_thickness"      width="5.0*RSU_rphi" length="VTXIB_curved_flex_length" phi_offset="VTXIB_curved_ring4_phi_offset" isCurved="true" material="Kapton" vis="CableVis" dz="VTXIB_curved_endcap4_length_side" side="+1" r="VTXIB_curved_flex_Aluminium_thickness+VTXIB_curved_curved_tolerance_r"/>
                    <component thickness="VTXIB_curved_sensitive_thickness" width="5.0*RSU_rphi" length="VTXIB_curved_endcap4_length_center" phi_offset="VTXIB_curved_ring4_phi_offset" isCurved="true" material="Silicon" vis="SiPeripheryVis" side="-1"/>
                    <component thickness="VTXIB_curved_sensitive_thickness" width="5.0*RSU_rphi" length="VTXIB_curved_endcap4_length_side" phi_offset="VTXIB_curved_ring4_phi_offset" isCurved="true" material="Silicon" vis="SiPeripheryVis" side="+1"/>
                </end_z>

                <end_z name="support_rings" r="VTXIB_curved_sensitive_thickness+VTXIB_curved_curved_tolerance_r">
                    <component thickness="VTXIB_curved_r_outer-VTXIB_curved_r4-VTXIB_curved_sensitive_thickness" width="M_PI*(VTXIB_curved_r4+VTXIB_curved_sensitive_thickness)" length="VTXIB_curved_support_ring_length" phi_offset="VTXIB_curved_ring4_phi_offset" isCurved="true" material="CarbonFoam" vis="CarbonFoam" dz="+VTXIB_curved_endcap4_length_center-VTXIB_curved_support_ring_length+VTXIB_curved_ring_zoffset"/>
                </end_z>
            </stave>


            <!-- Outer barrel -->
            <stave name="SiVTXOBStave1">
                <components name="flexes" r="0.0*mm" length="VTXOB_z1">
                    <component thickness="VTXO_flex_Aluminium_thickness" width="VTXO_flex_width" r="0.0*mm"                                                                  material="Al" vis="CableVis"/>
                    <component thickness="VTXO_flex_Kapton_thickness"    width="VTXO_flex_width" r="VTXO_flex_Aluminium_thickness"                                    material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXO_flex_Glue_thickness"      width="VTXO_flex_width" r="VTXO_flex_Aluminium_thickness+VTXO_flex_Kapton_thickness"  material="GlueEcobond45" vis="CableVis"/>
                </components>

                <!-- Sensor  -->
                <sensor r="VTXO_flex_thickness" thickness="VTXO_Sensitive_Thickness" material="Silicon">
                    <component sensitive="False" ymin="-(VTXO_sens_z_sensitive+VTXO_sens_z_periphery+VTXO_sens_z_sens_spacing/2.0)" ymax="-(VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0)"                    xmin="-(VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0)" xmax="VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0"    vis="SiPeripheryVis"/> <!-- top Quad periphery-->
                    <component sensitive="False" ymin="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"                          ymax="VTXO_sens_z_sensitive+VTXO_sens_z_periphery+VTXO_sens_z_sens_spacing/2.0" xmin="-(VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0)" xmax="VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0"    vis="SiPeripheryVis"/> <!-- bottom Quad periphery-->   
                    <component sensitive="False" ymin="-(VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0)"                       ymax="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"                       xmin="-(VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0)" xmax="-(VTXO_sens_rphi_sensitive+VTXO_sens_rphi_sens_spacing/2.0)"                          vis="SiPeripheryVis"/> <!-- left Quad periphery-->   
                    <component sensitive="False" ymin="-(VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0)"                       ymax="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"                       xmin="VTXO_sens_rphi_sensitive+VTXO_sens_rphi_sens_spacing/2.0"                             xmax="VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0"    vis="SiPeripheryVis"/> <!-- right Quad periphery-->   

                    <component sensitive="False" ymin="VTXO_sens_z_sens_spacing/2.0"                            ymax="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"   xmin="-VTXO_sens_rphi_sens_spacing/2.0"                             xmax="VTXO_sens_rphi_sens_spacing/2.0"                          vis="SiPeripheryVis"/> <!-- Middle cross: right -->
                    <component sensitive="False" ymin="-(VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0)"   ymax="-VTXO_sens_z_sens_spacing/2.0"                        xmin="-VTXO_sens_rphi_sens_spacing/2.0"                             xmax="VTXO_sens_rphi_sens_spacing/2.0"                          vis="SiPeripheryVis"/> <!-- Middle cross: left -->
                    <component sensitive="False" ymin="-VTXO_sens_z_sens_spacing/2.0"                           ymax="VTXO_sens_z_sens_spacing/2.0"                         xmin="VTXO_sens_rphi_sens_spacing/2.0"                              xmax="VTXO_sens_rphi_sens_spacing/2.0+VTXO_sens_rphi_sensitive" vis="SiPeripheryVis"/> <!-- Middle cross: top -->
                    <component sensitive="False" ymin="-VTXO_sens_z_sens_spacing/2.0"                           ymax="VTXO_sens_z_sens_spacing/2.0"                         xmin="-(VTXO_sens_rphi_sens_spacing/2.0+VTXO_sens_rphi_sensitive)"  xmax="-VTXO_sens_rphi_sens_spacing/2.0"                         vis="SiPeripheryVis"/> <!-- Middle cross: bottom -->
                    <component sensitive="False" ymin="-VTXO_sens_z_sens_spacing/2.0"                           ymax="VTXO_sens_z_sens_spacing/2.0"                         xmin="-VTXO_sens_rphi_sens_spacing/2.0"                             xmax="VTXO_sens_rphi_sens_spacing/2.0"                          vis="SiPeripheryVis"/> <!-- Middle cross: centre -->
                    
                    <component sensitive="True" ymin="-VTXO_sens_z_sensitive-VTXO_sens_z_sens_spacing/2.0"  ymax="-VTXO_sens_z_sens_spacing/2.0"                        xmin="VTXO_sens_rphi_sens_spacing/2.0"                              xmax="VTXO_sens_rphi_sens_spacing/2.0+VTXO_sens_rphi_sensitive" vis="SiSensitiveVis"/> <!-- top left sensitive -->
                    <component sensitive="True" ymin="VTXO_sens_z_sens_spacing/2.0"                         ymax="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"   xmin="VTXO_sens_rphi_sens_spacing/2.0"                              xmax="VTXO_sens_rphi_sens_spacing/2.0+VTXO_sens_rphi_sensitive" vis="SiSensitiveVis"/> <!-- top right sensitive -->               
                    <component sensitive="True" ymin="-VTXO_sens_z_sensitive-VTXO_sens_z_sens_spacing/2.0"  ymax="-VTXO_sens_z_sens_spacing/2.0"                        xmin="-VTXO_sens_rphi_sens_spacing/2.0-VTXO_sens_rphi_sensitive"    xmax="-VTXO_sens_rphi_sens_spacing/2.0"                         vis="SiSensitiveVis"/> <!-- bottom left sensitive -->
                    <component sensitive="True" ymin="VTXO_sens_z_sens_spacing/2.0"                         ymax="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"   xmin="-VTXO_sens_rphi_sens_spacing/2.0-VTXO_sens_rphi_sensitive"    xmax="-VTXO_sens_rphi_sens_spacing/2.0"                         vis="SiSensitiveVis"/> <!-- bottom right sensitive -->
                </sensor>

                <components name="support" r="VTXO_flex_thickness+VTXO_Sensitive_Thickness" length="VTXOB_z1">
                    <component thickness="VTXO_support_Fleece_thickness"         width="VTXO_mod_rphi" r="0.0*mm" material="CarbonFleece" vis="SupportVis"/> <!-- Thin stave holder: should be material="CarbonFleeceGraphite", not implemented yet! -->
                    <component thickness="VTXO_support_PaperGraphite_thickness"  width="VTXO_mod_rphi" r="VTXO_support_Fleece_thickness" material="CarbonFiberVtx" vis="SupportVis"/> <!-- Thin stave holder: should be material="PaperGraphite", not implemented yet, but only marginal difference in X0 -->
                    <component thickness="VTXO_support_CarbonFiber_thickness"    width="VTXO_mod_rphi" r="VTXO_support_Fleece_thickness+VTXO_support_PaperGraphite_thickness" material="CarbonFiberVtx" vis="SupportVis"/> <!-- Thin stave holder: should be material="K13D2U", but not implemented yet, but only marginal difference in X0 -->
                    <component thickness="VTXO_support_Fleece_thickness"         width="VTXO_mod_rphi" r="VTXO_support_Fleece_thickness+VTXO_support_PaperGraphite_thickness+VTXO_support_CarbonFiber_thickness" material="CarbonFleece" vis="SupportVis"/> <!-- Thin stave holder: should be material="CarbonFleeceGraphite", not implemented yet! -->

                    <component thickness="VTXOB_TrussStructure_thickness1" width="VTXO_mod_rphi"     r="VTXOB_support_thickness+VTXOB_TrussStructure_distance" material="CarbonFiberVtx" vis="TrussStructureVis"/> <!-- Proxy for the lightweight truss structure -->
                </components>

                <components name="coolingPipes" r="VTXO_flex_thickness+VTXO_Sensitive_Thickness+VTXOB_support_thickness" length="VTXOB_z1">
                    <component thickness="VTXO_Pipe_thickness"  width="VTXO_Pipe_rphi" offset="VTXOB_Pipe_offset" r="0.0*mm" material="KaptonVtx" vis="PipingVis"/> 
                    <component thickness="VTXO_Water_thickness" width="VTXO_Pipe_rphi" offset="VTXOB_Pipe_offset" r="VTXO_Pipe_thickness" material="Water" vis="WaterVis"/>
                    <component thickness="VTXO_Pipe_thickness"  width="VTXO_Pipe_rphi" offset="VTXOB_Pipe_offset" r="VTXO_Pipe_thickness+VTXO_Water_thickness" material="KaptonVtx" vis="PipingVis"/>

                    <component thickness="VTXO_Pipe_thickness"  width="VTXO_Pipe_rphi" offset="-VTXOB_Pipe_offset" r="0.0*mm" material="KaptonVtx" vis="PipingVis"/> 
                    <component thickness="VTXO_Water_thickness" width="VTXO_Pipe_rphi" offset="-VTXOB_Pipe_offset" r="VTXO_Pipe_thickness" material="Water" vis="WaterVis"/>
                    <component thickness="VTXO_Pipe_thickness"  width="VTXO_Pipe_rphi" offset="-VTXOB_Pipe_offset" r="VTXO_Pipe_thickness+VTXO_Water_thickness" material="KaptonVtx" vis="PipingVis"/>
                </components>

                <!-- End of stave structures -->
                <end_z name="endOfStave" r="0.0*mm">
                    <!-- Hybrid -->
                    <component thickness="VTXO_hybrid_thickness" width="VTXO_mod_rphi" length="VTXO_hybrid_length" dz="VTXOB_mod_z_spacing" r="VTXO_flex_thickness-VTXO_hybrid_thickness" material="PCB" vis="HybridVis"/>

                    <!-- Terminal part -->
                    <component thickness="VTXOB_TerminalPart_L1_thickness1" width="VTXOB_TerminalPart_L1_width1" length="VTXOB_TerminalPart_L1_length1" dz="VTXOB_mod_z_spacing+VTXO_hybrid_length" r="0.0*mm"                          material="PEEK" vis="TerminalPartVis"/>
                    <component thickness="VTXOB_TerminalPart_L1_thickness2" width="VTXOB_TerminalPart_L1_width2" length="VTXOB_TerminalPart_L1_length2" dz="VTXOB_mod_z_spacing+VTXO_hybrid_length" r="6.5*mm"   material="PEEK" vis="TerminalPartVis"/>
                    <component thickness="VTXOB_TerminalPart_L1_thickness3" width="VTXOB_TerminalPart_L1_width3" length="VTXOB_TerminalPart_L1_length3" dz="VTXOB_mod_z_spacing+VTXO_hybrid_length+VTXOB_TerminalPart_L1_length2" r="6.5*mm"   material="PEEK" vis="TerminalPartVis"/>
                </end_z>
            </stave>

            <!-- Definition of our "stave" object that is used to build the barrel, here for the outer layer -->
            <stave name="SiVTXOBStave2">
                <components name="support" r="0.0*mm" length="VTXOB_z2">
                    <component thickness="VTXOB_TrussStructure_thickness2" width="VTXO_mod_rphi"     r="-VTXOB_TrussStructure_distance" material="CarbonFiberVtx" vis="TrussStructureVis"/>   <!--Proxy for the lightweight truss structure -->

                    <component thickness="VTXO_support_Fleece_thickness"         width="VTXO_mod_rphi" r="0.0*mm" material="CarbonFiberVtx" vis="SupportVis"/>  <!--Thin stave holder: should be material="CarbonFleeceGraphite", not implemented yet! -->
                    <component thickness="VTXO_support_PaperGraphite_thickness"  width="VTXO_mod_rphi" r="VTXO_support_Fleece_thickness" material="CarbonFiberVtx" vis="SupportVis"/>   <!--Thin stave holder: should be material="PaperGraphite", not implemented yet! -->
                    <component thickness="VTXO_support_CarbonFiber_thickness"    width="VTXO_mod_rphi" r="VTXO_support_Fleece_thickness+VTXO_support_PaperGraphite_thickness" material="CarbonFiberVtx" vis="SupportVis"/>
                    <component thickness="VTXO_support_Fleece_thickness"         width="VTXO_mod_rphi" r="VTXO_support_Fleece_thickness+VTXO_support_PaperGraphite_thickness+VTXO_support_CarbonFiber_thickness" material="CarbonFiberVtx" vis="SupportVis"/> <!-- Thin stave holder: should be material="CarbonFleeceGraphite", not implemented yet! -->
                </components>

                <components name="coolingPipes" r="-VTXO_Pipe_thickness" length="VTXOB_z2">
                    <component thickness="VTXO_Pipe_thickness"  width="VTXO_Pipe_rphi" offset="VTXOB_Pipe_offset" r="0.0*mm" material="KaptonVtx" vis="PipingVis"/> 
                    <component thickness="VTXO_Water_thickness" width="VTXO_Pipe_rphi" offset="VTXOB_Pipe_offset" r="-VTXO_Water_thickness" material="Water" vis="WaterVis"/>
                    <component thickness="VTXO_Pipe_thickness"  width="VTXO_Pipe_rphi" offset="VTXOB_Pipe_offset" r="-VTXO_Water_thickness-VTXO_Pipe_thickness" material="KaptonVtx" vis="PipingVis"/>

                    <component thickness="VTXO_Pipe_thickness"  width="VTXO_Pipe_rphi" offset="-VTXOB_Pipe_offset" r="0.0*mm" material="KaptonVtx" vis="PipingVis"/> 
                    <component thickness="VTXO_Water_thickness" width="VTXO_Pipe_rphi" offset="-VTXOB_Pipe_offset" r="-VTXO_Water_thickness" material="Water" vis="WaterVis"/>
                    <component thickness="VTXO_Pipe_thickness"  width="VTXO_Pipe_rphi" offset="-VTXOB_Pipe_offset" r="-VTXO_Water_thickness-VTXO_Pipe_thickness" material="KaptonVtx" vis="PipingVis"/>
                </components>

                 <!-- Sensor  -->
                <sensor r="VTXOB_support_thickness" thickness="VTXO_Sensitive_Thickness" material="Silicon">
                    <component sensitive="False" ymin="-(VTXO_sens_z_sensitive+VTXO_sens_z_periphery+VTXO_sens_z_sens_spacing/2.0)" ymax="-(VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0)"                    xmin="-(VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0)" xmax="VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0"    vis="SiPeripheryVis"/> <!-- top Quad periphery-->
                    <component sensitive="False" ymin="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"                          ymax="VTXO_sens_z_sensitive+VTXO_sens_z_periphery+VTXO_sens_z_sens_spacing/2.0" xmin="-(VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0)" xmax="VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0"    vis="SiPeripheryVis"/> <!-- bottom Quad periphery-->   
                    <component sensitive="False" ymin="-(VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0)"                       ymax="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"                       xmin="-(VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0)" xmax="-(VTXO_sens_rphi_sensitive+VTXO_sens_rphi_sens_spacing/2.0)"                          vis="SiPeripheryVis"/> <!-- left Quad periphery-->   
                    <component sensitive="False" ymin="-(VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0)"                       ymax="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"                       xmin="VTXO_sens_rphi_sensitive+VTXO_sens_rphi_sens_spacing/2.0"                             xmax="VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0"    vis="SiPeripheryVis"/> <!-- right Quad periphery-->   

                    <component sensitive="False" ymin="VTXO_sens_z_sens_spacing/2.0"                            ymax="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"   xmin="-VTXO_sens_rphi_sens_spacing/2.0"                             xmax="VTXO_sens_rphi_sens_spacing/2.0"                          vis="SiPeripheryVis"/> <!-- Middle cross: right -->
                    <component sensitive="False" ymin="-(VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0)"   ymax="-VTXO_sens_z_sens_spacing/2.0"                        xmin="-VTXO_sens_rphi_sens_spacing/2.0"                             xmax="VTXO_sens_rphi_sens_spacing/2.0"                          vis="SiPeripheryVis"/> <!-- Middle cross: left -->
                    <component sensitive="False" ymin="-VTXO_sens_z_sens_spacing/2.0"                           ymax="VTXO_sens_z_sens_spacing/2.0"                         xmin="VTXO_sens_rphi_sens_spacing/2.0"                              xmax="VTXO_sens_rphi_sens_spacing/2.0+VTXO_sens_rphi_sensitive" vis="SiPeripheryVis"/> <!-- Middle cross: top -->
                    <component sensitive="False" ymin="-VTXO_sens_z_sens_spacing/2.0"                           ymax="VTXO_sens_z_sens_spacing/2.0"                         xmin="-(VTXO_sens_rphi_sens_spacing/2.0+VTXO_sens_rphi_sensitive)"  xmax="-VTXO_sens_rphi_sens_spacing/2.0"                         vis="SiPeripheryVis"/> <!-- Middle cross: bottom -->
                    <component sensitive="False" ymin="-VTXO_sens_z_sens_spacing/2.0"                           ymax="VTXO_sens_z_sens_spacing/2.0"                         xmin="-VTXO_sens_rphi_sens_spacing/2.0"                             xmax="VTXO_sens_rphi_sens_spacing/2.0"                          vis="SiPeripheryVis"/> <!-- Middle cross: centre -->
                    
                    <component sensitive="True" ymin="-VTXO_sens_z_sensitive-VTXO_sens_z_sens_spacing/2.0"  ymax="-VTXO_sens_z_sens_spacing/2.0"                        xmin="VTXO_sens_rphi_sens_spacing/2.0"                              xmax="VTXO_sens_rphi_sens_spacing/2.0+VTXO_sens_rphi_sensitive" vis="SiSensitiveVis"/> <!-- top left sensitive -->
                    <component sensitive="True" ymin="VTXO_sens_z_sens_spacing/2.0"                         ymax="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"   xmin="VTXO_sens_rphi_sens_spacing/2.0"                              xmax="VTXO_sens_rphi_sens_spacing/2.0+VTXO_sens_rphi_sensitive" vis="SiSensitiveVis"/> <!-- top right sensitive -->               
                    <component sensitive="True" ymin="-VTXO_sens_z_sensitive-VTXO_sens_z_sens_spacing/2.0"  ymax="-VTXO_sens_z_sens_spacing/2.0"                        xmin="-VTXO_sens_rphi_sens_spacing/2.0-VTXO_sens_rphi_sensitive"    xmax="-VTXO_sens_rphi_sens_spacing/2.0"                         vis="SiSensitiveVis"/> <!-- bottom left sensitive -->
                    <component sensitive="True" ymin="VTXO_sens_z_sens_spacing/2.0"                         ymax="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"   xmin="-VTXO_sens_rphi_sens_spacing/2.0-VTXO_sens_rphi_sensitive"    xmax="-VTXO_sens_rphi_sens_spacing/2.0"                         vis="SiSensitiveVis"/> <!-- bottom right sensitive -->
                </sensor>

                <components name="flexes" r="VTXOB_support_thickness+VTXO_Sensitive_Thickness" length="VTXOB_z2">
                    <component thickness="VTXO_flex_Aluminium_thickness" width="VTXO_flex_width" r="0.0*mm"                                                                  material="Al" vis="CableVis"/>
                    <component thickness="VTXO_flex_Kapton_thickness"    width="VTXO_flex_width" r="VTXO_flex_Aluminium_thickness"                                    material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXO_flex_Glue_thickness"      width="VTXO_flex_width" r="VTXO_flex_Aluminium_thickness+VTXO_flex_Kapton_thickness"  material="GlueEcobond45" vis="CableVis"/>
                </components>

                <!-- End of stave structures -->
                <end_z name="endOfStave" r="VTXOB_support_thickness+VTXO_Sensitive_Thickness">
                    <!-- Hybrid -->
                    <component thickness="VTXO_hybrid_thickness" width="VTXO_mod_rphi" length="VTXO_hybrid_length" dz="VTXOB_mod_z_spacing" r="0.0*mm" material="PCB" vis="HybridVis"/>

                    <!-- Terminal part -->
                    <component thickness="VTXOB_TerminalPart_L2_thickness1" width="VTXOB_TerminalPart_L2_width1" length="VTXOB_TerminalPart_L2_length1" dz="VTXOB_mod_z_spacing+VTXO_hybrid_length" r="-VTXOB_TerminalPart_L2_thickness1"                                 material="PEEK" vis="TerminalPartVis"/>
                    <component thickness="VTXOB_TerminalPart_L2_thickness2" width="VTXOB_TerminalPart_L2_width2" length="VTXOB_TerminalPart_L2_length2" dz="VTXOB_mod_z_spacing+VTXO_hybrid_length" r="-VTXOB_TerminalPart_L2_thickness1-12.771*mm"   material="PEEK" vis="TerminalPartVis"/>
                    <component thickness="VTXOB_TerminalPart_L2_thickness3" width="VTXOB_TerminalPart_L2_width3" length="VTXOB_TerminalPart_L2_length3" dz="VTXOB_mod_z_spacing+VTXO_hybrid_length+VTXOB_TerminalPart_L2_length2" r="-VTXOB_TerminalPart_L2_thickness1-12.771*mm"   material="PEEK" vis="TerminalPartVis"/>
                </end_z>
            </stave>

            <!-- Vertex inner barrel -->
            <!-- <layer nLadders="VTXIB_L1_Staves" phi0="0.0" r="VTXIB_r1" offset="VTXIB_L1_offset" id="0" nmodules="VTXIB_L1_nModules" name="SiVTXIBStave1" step="VTXIB_mod_z_spacing" dr="VTXIB_dr1" motherVolLength="2.0*(VTXIB_z1+VTXIB_hybrid_z+VTXIB_mod_z_spacing)" motherVolThickness="VTXIB_r2-VTXIB_r1"/>
            <layer nLadders="VTXIB_L2_Staves" phi0="0.0" r="VTXIB_r2" offset="VTXIB_L2_offset" id="1" nmodules="VTXIB_L2_nModules" name="SiVTXIBStave2" step="VTXIB_mod_z_spacing" dr="VTXIB_dr2" motherVolLength="2.0*(VTXIB_z2+VTXIB_hybrid_z+VTXIB_mod_z_spacing)" motherVolThickness="VTXIB_r3-VTXIB_r2"/>
            <layer nLadders="VTXIB_L3_Staves" phi0="0.0" r="VTXIB_r3" offset="VTXIB_L3_offset" id="2" nmodules="VTXIB_L3_nModules" name="SiVTXIBStave3" step="VTXIB_mod_z_spacing" dr="VTXIB_dr3" motherVolLength="2.0*(VTXIB_z3+VTXIB_hybrid_z+VTXIB_mod_z_spacing)" motherVolThickness="12.0*mm"/> -->

            <!-- Ultra-light vertex -->
            <layer nLadders="2" phi0="0.5*RSU_rphi/(2*M_PI*VTXIB_curved_r1)*360.*deg+VTXIB_curved_phi0_1" r="VTXIB_curved_r1" id="0" nmodules="VTXIB_curved_nModules1" name="SiVTXIBStave1Curved" step="0.0*mm" motherVolThickness="VTXIB_curved_r2-VTXIB_curved_r1"        motherVolLength="VTXIB_z1_passive"/>
            <layer nLadders="2" phi0="0.5*RSU_rphi/(2*M_PI*VTXIB_curved_r2)*360.*deg+VTXIB_curved_phi0_2" r="VTXIB_curved_r2" id="1" nmodules="VTXIB_curved_nModules2" name="SiVTXIBStave2Curved" step="0.0*mm" motherVolThickness="VTXIB_curved_r3-VTXIB_curved_r2"        motherVolLength="VTXIB_z2_passive"/>
            <layer nLadders="2" phi0="0.5*RSU_rphi/(2*M_PI*VTXIB_curved_r3)*360.*deg+VTXIB_curved_phi0_3" r="VTXIB_curved_r3" id="2" nmodules="VTXIB_curved_nModules3" name="SiVTXIBStave3Curved" step="0.0*mm" motherVolThickness="VTXIB_curved_r4-VTXIB_curved_r3"        motherVolLength="VTXIB_z3_passive" z_offset="VTXIB_curved_gap_z3+2.0*VTXIB_curved_endcap3_length_center" nUnits="2"/>
            <layer nLadders="2" phi0="0.5*RSU_rphi/(2*M_PI*VTXIB_curved_r4)*360.*deg+VTXIB_curved_phi0_4" r="VTXIB_curved_r4" id="3" nmodules="VTXIB_curved_nModules4" name="SiVTXIBStave4Curved" step="0.0*mm" motherVolThickness="VTXIB_curved_r_outer-VTXIB_curved_r4"   motherVolLength="VTXIB_z4_passive" z_offset="VTXIB_curved_gap_z4+2.0*VTXIB_curved_endcap4_length_center" nUnits="2"/>

            <!-- Vertex outer barrel -->
            <layer nLadders="VTXOB_Staves1" phi0="0.0" r="VTXOB_r1" offset="VTXOB_offset1" id="nInnerVertexLayers+0" nmodules="VTXOB_nModules1" name="SiVTXOBStave1" step="VTXOB_mod_z_spacing" motherVolThickness="1.2*cm" motherVolLength="VTXOB_z1_passive"/>
            <layer nLadders="VTXOB_Staves2" phi0="0.0" r="VTXOB_r2" offset="VTXOB_offset2" id="nInnerVertexLayers+1" nmodules="VTXOB_nModules2" name="SiVTXOBStave2" step="VTXOB_mod_z_spacing" motherVolThickness="3.0*cm" motherVolRmin="VTXOB_r2-VTXOB_TerminalPart_L2_thickness1-12.771*mm" motherVolLength="VTXOB_z2_passive"/>
        </detector>


        <!-- Vertex inner barrel support structure imported via DDCAD, material budget evaluation with g4MaterialScan is working, but not with the k4SimGeant4 methods. Should be furthermore rotated by 90 degrees around z, but feature not working currently -->
         <!-- <detector id="DetID_NOTUSED" name="VTXIBSupport" type="DD4hep_TestShape_Creator">
            <envelope vis="VXDVis">
                <shape type="Assembly"/>
            </envelope>
            <check>
                <shape type="CAD_MultiVolume" ref="VertexSupport_o1_v02.obj" unit="mm"/>
                <rotation x="0" y="0" z="0"/>
            </check>
        </detector>  -->

        <!-- Vertex disks -->
        <detector id="DetID_VXD_Disks" name="VertexEndcap" vis="VXDVis" type="VertexDisks_detailed_o1_v01" readout="VTXDCollection" reflect="true" region="VTXDRegion">
            <envelope vis="VXDVis">
                <shape type="BooleanShape" operation="Subtraction" material="Air">
                    <shape type="BooleanShape" operation="Subtraction" material="Air">
                        <shape type="BooleanShape" operation="Subtraction" material="Air">
                            <shape type="BooleanShape" operation="Subtraction" material="Air">
                                <shape type="BooleanShape" operation="Subtraction" material="Air">
                                    <shape type="BooleanShape" operation="Subtraction" material="Air">
                                        <shape type="BooleanShape" operation="Subtraction" material="Air">
                                            <shape type="Tube" rmin="VTXD_rmin1" rmax="VTXD_r_max" dz="VTXD_z_max_total"/>

                                            <shape type="Tube" rmin="VTXIB_r_min_layer-VTXIB_r_min_clearance" rmax="VTXIB_r_max_layer+VTXIB_r_max_clearance" dz="VTXIB_half_length"/> <!-- Subtract volume of inner barrel to avoid overlap -->
                                            <position x="0" y="0" z="0"/>
                                        </shape>
                                        <shape type="Tube" rmin="VTXOB_r_max_layer-VTXOB_TerminalPart_L2_thickness1-12.771*mm" rmax="VTXOB_r_max_layer+VTXOB_rmax_clearance" dz="VTXOB_z2_passive/2."/> <!-- Subtract volume of outermost barrel to avoid overlap -->
                                        <position x="0" y="0" z="0"/>
                                    </shape>
                                    
                                    <shape type="Tube" rmin="0.0*mm" rmax="VTXD_r_max" dz="VTXD_z_min_total"/> <!-- Subtract inner area between disks -->
                                    <position x="0" y="0" z="0"/>
                                </shape>

                                <shape type="Cone" rmin1="0" rmax1="tan(VertexClearanceTheta)*VTXD_z_max_total" rmin2="0" rmax2="0" z="VTXD_z_max_total/2."/>
                                <position x="0" y="0" z="-VTXD_z_max_total/2." />
                            </shape>

                            <shape type="Cone" rmin1="0" rmax1="0" rmin2="0" rmax2="tan(VertexClearanceTheta)*VTXD_z_max_total" z="VTXD_z_max_total/2."/>
                            <position x="0" y="0" z="VTXD_z_max_total/2." />
                        </shape>
                        <shape type="Cone" rmin1="0" rmax1="tan(VertexClearanceTheta)*2000.0*mm" rmin2="0" rmax2="0" z="2000.0*mm/2."/>
                        <position x="0" y="0" z="-2000.0*mm/2." />
                    </shape>   
                <shape type="Cone" rmin1="0" rmax1="0" rmin2="0" rmax2="tan(VertexClearanceTheta)*2000.0*mm" z="2000.0*mm/2."/>
                <position x="0" y="0" z="2000.0*mm/2." />
            </shape>
            </envelope>

            <!-- <envelope vis="VXDVis">
                <shape type="Assembly"/>
            </envelope> -->

            <comment>Vertex Detector Disks</comment>

            <type_flags type=" DetType_TRACKER + DetType_PIXEL + DetType_VERTEX + DetType_ENDCAP"/>

            <!-- Definition of our stave that is used to build the disks -->
            <module name="SiVTXDStave">
                <components name="flex_low_z" z_offset="0.0*mm">
                    <component thickness="VTXO_flex_Aluminium_thickness"    width="VTXO_flex_width" z_offset="0.0*mm" material="Al" vis="CableVis"/>
                    <component thickness="VTXO_flex_Kapton_thickness"       width="VTXO_flex_width" z_offset="VTXO_flex_Aluminium_thickness" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXO_flex_Glue_thickness"         width="VTXO_flex_width" z_offset="VTXO_flex_Aluminium_thickness+VTXO_flex_Kapton_thickness" material="GlueEcobond45" vis="CableVis"/> <!-- NEED TO USE CORRECT GLUE DESCRIPTION!-->
                </components>

                <sensor z_offset="VTXO_flex_thickness" thickness="VTXO_Sensitive_Thickness" material="Silicon">
                    <component sensitive="False" ymin="-(VTXO_sens_z_sensitive+VTXO_sens_z_periphery+VTXO_sens_z_sens_spacing/2.0)" ymax="-(VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0)"                    xmin="-(VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0)" xmax="VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0"    vis="SiPeripheryVis"/> <!-- top Quad periphery-->
                    <component sensitive="False" ymin="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"                          ymax="VTXO_sens_z_sensitive+VTXO_sens_z_periphery+VTXO_sens_z_sens_spacing/2.0" xmin="-(VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0)" xmax="VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0"    vis="SiPeripheryVis"/> <!-- bottom Quad periphery-->   
                    <component sensitive="False" ymin="-(VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0)"                       ymax="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"                       xmin="-(VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0)" xmax="-(VTXO_sens_rphi_sensitive+VTXO_sens_rphi_sens_spacing/2.0)"                          vis="SiPeripheryVis"/> <!-- left Quad periphery-->   
                    <component sensitive="False" ymin="-(VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0)"                       ymax="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"                       xmin="VTXO_sens_rphi_sensitive+VTXO_sens_rphi_sens_spacing/2.0"                             xmax="VTXO_sens_rphi_sensitive+VTXO_sens_rphi_periphery+VTXO_sens_rphi_sens_spacing/2.0"    vis="SiPeripheryVis"/> <!-- right Quad periphery-->   

                    <component sensitive="False" ymin="VTXO_sens_z_sens_spacing/2.0"                            ymax="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"   xmin="-VTXO_sens_rphi_sens_spacing/2.0"                             xmax="VTXO_sens_rphi_sens_spacing/2.0"                          vis="SiPeripheryVis"/> <!-- Middle cross: right -->
                    <component sensitive="False" ymin="-(VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0)"   ymax="-VTXO_sens_z_sens_spacing/2.0"                        xmin="-VTXO_sens_rphi_sens_spacing/2.0"                             xmax="VTXO_sens_rphi_sens_spacing/2.0"                          vis="SiPeripheryVis"/> <!-- Middle cross: left -->
                    <component sensitive="False" ymin="-VTXO_sens_z_sens_spacing/2.0"                           ymax="VTXO_sens_z_sens_spacing/2.0"                         xmin="VTXO_sens_rphi_sens_spacing/2.0"                              xmax="VTXO_sens_rphi_sens_spacing/2.0+VTXO_sens_rphi_sensitive" vis="SiPeripheryVis"/> <!-- Middle cross: top -->
                    <component sensitive="False" ymin="-VTXO_sens_z_sens_spacing/2.0"                           ymax="VTXO_sens_z_sens_spacing/2.0"                         xmin="-(VTXO_sens_rphi_sens_spacing/2.0+VTXO_sens_rphi_sensitive)"  xmax="-VTXO_sens_rphi_sens_spacing/2.0"                         vis="SiPeripheryVis"/> <!-- Middle cross: bottom -->
                    <component sensitive="False" ymin="-VTXO_sens_z_sens_spacing/2.0"                           ymax="VTXO_sens_z_sens_spacing/2.0"                         xmin="-VTXO_sens_rphi_sens_spacing/2.0"                             xmax="VTXO_sens_rphi_sens_spacing/2.0"                          vis="SiPeripheryVis"/> <!-- Middle cross: centre -->
                    
                    <component sensitive="True" ymin="-VTXO_sens_z_sensitive-VTXO_sens_z_sens_spacing/2.0"  ymax="-VTXO_sens_z_sens_spacing/2.0"                        xmin="VTXO_sens_rphi_sens_spacing/2.0"                              xmax="VTXO_sens_rphi_sens_spacing/2.0+VTXO_sens_rphi_sensitive" vis="SiSensitiveVis"/> <!-- top left sensitive -->
                    <component sensitive="True" ymin="VTXO_sens_z_sens_spacing/2.0"                         ymax="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"   xmin="VTXO_sens_rphi_sens_spacing/2.0"                              xmax="VTXO_sens_rphi_sens_spacing/2.0+VTXO_sens_rphi_sensitive" vis="SiSensitiveVis"/> <!-- top right sensitive -->               
                    <component sensitive="True" ymin="-VTXO_sens_z_sensitive-VTXO_sens_z_sens_spacing/2.0"  ymax="-VTXO_sens_z_sens_spacing/2.0"                        xmin="-VTXO_sens_rphi_sens_spacing/2.0-VTXO_sens_rphi_sensitive"    xmax="-VTXO_sens_rphi_sens_spacing/2.0"                         vis="SiSensitiveVis"/> <!-- bottom left sensitive -->
                    <component sensitive="True" ymin="VTXO_sens_z_sens_spacing/2.0"                         ymax="VTXO_sens_z_sensitive+VTXO_sens_z_sens_spacing/2.0"   xmin="-VTXO_sens_rphi_sens_spacing/2.0-VTXO_sens_rphi_sensitive"    xmax="-VTXO_sens_rphi_sens_spacing/2.0"                         vis="SiSensitiveVis"/> <!-- bottom right sensitive -->
                </sensor>

                <components name="support_low_z" z_offset="VTXO_flex_thickness+VTXO_Sensitive_Thickness">
                    <component thickness="VTXO_support_Fleece_thickness"         width="VTXO_mod_z" z_offset="0.0*mm" material="CarbonFiberVtx" vis="SupportVis"/> <!-- should be material="CarbonFleeceGraphite", not implemented yet! -->
                    <component thickness="VTXO_support_CarbonFiber_thickness"    width="VTXO_mod_z" z_offset="VTXO_support_Fleece_thickness" material="CarbonFiberVtx" vis="SupportVis"/>
                    <component thickness="VTXO_support_PaperGraphite_thickness"  width="VTXO_mod_z" z_offset="VTXO_support_Fleece_thickness+VTXO_support_CarbonFiber_thickness" material="CarbonFiberVtx" vis="SupportVis"/> <!-- should be material="CarbonPaperGraphite", not implemented yet! -->
                    <component thickness="VTXO_support_Fleece_thickness"         width="VTXO_mod_z" z_offset="VTXO_support_Fleece_thickness+VTXO_support_CarbonFiber_thickness+VTXO_support_PaperGraphite_thickness" material="CarbonFiberVtx" vis="SupportVis"/> <!-- should be material="CarbonFleeceGraphite", not implemented yet! -->
                </components>

                <components name="cooling_pipes" z_offset="VTXO_flex_thickness+VTXO_Sensitive_Thickness+VTXD_stave_dz/2.0-VTXO_Pipe_thickness-VTXO_Water_thickness/2.0">
                    <component thickness="VTXO_Pipe_thickness"  width="VTXO_Pipe_rphi" offset="-VTXD_Pipe_offset" z_offset="0.0*mm" material="KaptonVtx" vis="PipingVis"/> 
                    <component thickness="VTXO_Water_thickness" width="VTXO_Pipe_rphi" offset="-VTXD_Pipe_offset" z_offset="VTXO_Pipe_thickness" material="Water" vis="WaterVis"/>
                    <component thickness="VTXO_Pipe_thickness"  width="VTXO_Pipe_rphi" offset="-VTXD_Pipe_offset" z_offset="VTXO_Pipe_thickness+VTXO_Water_thickness" material="KaptonVtx" vis="PipingVis"/>

                    <component thickness="VTXO_Pipe_thickness"  width="VTXO_Pipe_rphi" offset="VTXD_Pipe_offset" z_offset="0.0*mm" material="KaptonVtx" vis="PipingVis"/> 
                    <component thickness="VTXO_Water_thickness" width="VTXO_Pipe_rphi" offset="VTXD_Pipe_offset" z_offset="VTXO_Pipe_thickness" material="Water" vis="WaterVis"/>
                    <component thickness="VTXO_Pipe_thickness"  width="VTXO_Pipe_rphi" offset="VTXD_Pipe_offset" z_offset="VTXO_Pipe_thickness+VTXO_Water_thickness" material="KaptonVtx" vis="PipingVis"/>
                </components>

                <components name="support_high_z" z_offset="VTXO_flex_thickness+VTXO_Sensitive_Thickness+VTXD_stave_dz">
                    <component thickness="VTXO_support_Fleece_thickness"         width="VTXO_mod_z" z_offset="0.0*mm" material="CarbonFiberVtx" vis="SupportVis"/> <!-- should be material="CarbonFleeceGraphite", not implemented yet! -->
                    <component thickness="VTXO_support_PaperGraphite_thickness"  width="VTXO_mod_z" z_offset="VTXO_support_Fleece_thickness" material="CarbonFiberVtx" vis="SupportVis"/> <!-- should be material="CarbonPaperGraphite", not implemented yet! -->
                    <component thickness="VTXO_support_CarbonFiber_thickness"    width="VTXO_mod_z" z_offset="VTXO_support_Fleece_thickness+VTXO_support_PaperGraphite_thickness" material="CarbonFiberVtx" vis="SupportVis"/>
                    <component thickness="VTXO_support_Fleece_thickness"         width="VTXO_mod_z" z_offset="VTXO_support_Fleece_thickness+VTXO_support_PaperGraphite_thickness+VTXO_support_CarbonFiber_thickness" material="CarbonFiberVtx" vis="SupportVis"/> <!-- should be material="CarbonFleeceGraphite", not implemented yet! -->
                </components>

                <components name="flex_high_z" z_offset="VTXO_flex_thickness+2.0*(VTXO_Sensitive_Thickness+VTXD_support_thickness)+VTXD_stave_dz">
                    <component thickness="VTXO_flex_Glue_thickness"         width="VTXO_flex_width" z_offset="0.0*mm" material="GlueEcobond45" vis="CableVis"/> <!-- NEED TO USE CORRECT GLUE DESCRIPTION!-->
                    <component thickness="VTXO_flex_Kapton_thickness"       width="VTXO_flex_width" z_offset="VTXO_flex_Glue_thickness" material="KaptonVtx" vis="CableVis"/>
                    <component thickness="VTXO_flex_Aluminium_thickness"    width="VTXO_flex_width" z_offset="VTXO_flex_Glue_thickness+VTXO_flex_Kapton_thickness" material="Al" vis="CableVis"/>
                </components>


                <end_z name="hybrids" z_offset="VTXO_flex_thickness+VTXO_Sensitive_Thickness">
                    <component thickness="VTXO_hybrid_thickness" width="VTXO_mod_rphi" length="VTXO_hybrid_length" dx="VTXO_hybrid_dx" x="0.001*mm" z_offset="0.0*mm" material="PCB" vis="HybridVis"/> <!-- Hybrid in front, only on one side (x>0) -->
                    <component thickness="VTXO_hybrid_thickness" width="VTXO_mod_rphi" length="VTXO_hybrid_length" dx="VTXO_hybrid_dx" x="0.001*mm" z_offset="VTXO_hybrid_thickness+VTXD_stave_dz-VTXO_hybrid_thickness" material="PCB" vis="HybridVis"/> <!-- Hybrid in back, only on one side (x>0) -->
                </end_z>

                <end_z name="terminal_parts" z_offset="VTXO_flex_thickness+VTXO_Sensitive_Thickness+VTXD_stave_dz/2.0-VTXD_Terminal_thickness/2.">
                    <component thickness="VTXD_Terminal_thickness" width="VTXO_mod_rphi" length="VTXD_TerminalPart_length" dx="VTXO_hybrid_length+VTXO_hybrid_dx" x="0.001*mm"  material="PEEK" vis="TerminalPartVis"/>   <!-- Terminal part left (x>0) -->
                    <component thickness="VTXD_Terminal_thickness" width="VTXO_mod_rphi" length="VTXD_TerminalPart_length" dx="0.0*mm" x="-0.001*mm"  material="PEEK" vis="TerminalPartVis"/> <!-- Terminal part right (x<0) -->
                </end_z>
            </module>

            <!-- Here we construct the disks, all disks use the same base stave (SiVTXDStave) with different numbers of modules and other properties -->
           <layer id="0" z="VTXD_z1" nphi="2" dz="VTXD_dz1" rmin="VTXD_rmin1" rmax="VTXOB_r_max_layer-VTXOB_TerminalPart_L2_thickness1-12.771*mm" motherVolThickness="5.5*cm" reflect_rot="pi/4.0">
                <!-- Face B, one half -->
                <stave nmodules="2" z_offset="VTXD_disk1_zoffset_stave1B_1" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave1B" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="3" z_offset="VTXD_disk1_zoffset_stave2B_1" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave2B" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="4" z_offset="VTXD_disk1_zoffset_stave3B_1" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave3B" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="4" z_offset="VTXD_disk1_zoffset_stave4B_1" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave4B" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="5" z_offset="VTXD_disk1_zoffset_stave5B_1" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave5B" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="6" z_offset="VTXD_disk1_zoffset_stave6B_1" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave6B" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="6" z_offset="VTXD_disk1_zoffset_stave7B_1" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave7B" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>

                <!-- Face B, other half -->
                <stave nmodules="2" z_offset="8.5*mm+VTXD_disk1_zoffset_stave1B_2" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave1B" step="VTXDModOverlap" phi0="pi/2.0*rad+VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="3" z_offset="8.5*mm+VTXD_disk1_zoffset_stave2B_2" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave2B" step="VTXDModOverlap" phi0="pi/2.0*rad+VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="4" z_offset="8.5*mm+VTXD_disk1_zoffset_stave3B_2" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave3B" step="VTXDModOverlap" phi0="pi/2.0*rad+VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="4" z_offset="8.5*mm+VTXD_disk1_zoffset_stave4B_2" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave4B" step="VTXDModOverlap" phi0="pi/2.0*rad+VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="5" z_offset="8.5*mm+VTXD_disk1_zoffset_stave5B_2" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave5B" step="VTXDModOverlap" phi0="pi/2.0*rad+VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="6" z_offset="8.5*mm+VTXD_disk1_zoffset_stave6B_2" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave6B" step="VTXDModOverlap" phi0="pi/2.0*rad+VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="6" z_offset="8.5*mm+VTXD_disk1_zoffset_stave7B_2" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave7B" step="VTXDModOverlap" phi0="pi/2.0*rad+VTXD_phi1B" module="SiVTXDStave"/>

                <!-- Face A, one half -->
                <stave nmodules="2" z_offset="VTXD_zoffset_face1+VTXD_disk1_zoffset_stave1A_1" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave1A" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="3" z_offset="VTXD_zoffset_face1+VTXD_disk1_zoffset_stave2A_1" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave2A" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="4" z_offset="VTXD_zoffset_face1+VTXD_disk1_zoffset_stave3A_1" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave3A" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="5" z_offset="VTXD_zoffset_face1+VTXD_disk1_zoffset_stave4A_1" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave4A" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="5" z_offset="VTXD_zoffset_face1+VTXD_disk1_zoffset_stave5A_1" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave5A" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="6" z_offset="VTXD_zoffset_face1+VTXD_disk1_zoffset_stave6A_1" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave6A" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="6" z_offset="VTXD_zoffset_face1+VTXD_disk1_zoffset_stave7A_1" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave7A" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>

                <!-- Face A, other half -->
                <stave nmodules="2" z_offset="VTXD_zoffset_face1+13.5*mm+VTXD_disk1_zoffset_stave1A_2" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave1A" step="VTXDModOverlap" phi0="pi/2.0*rad+VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="3" z_offset="VTXD_zoffset_face1+13.5*mm+VTXD_disk1_zoffset_stave2A_2" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave2A" step="VTXDModOverlap" phi0="pi/2.0*rad+VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="4" z_offset="VTXD_zoffset_face1+13.5*mm+VTXD_disk1_zoffset_stave3A_2" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave3A" step="VTXDModOverlap" phi0="pi/2.0*rad+VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="5" z_offset="VTXD_zoffset_face1+13.5*mm+VTXD_disk1_zoffset_stave4A_2" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave4A" step="VTXDModOverlap" phi0="pi/2.0*rad+VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="5" z_offset="VTXD_zoffset_face1+13.5*mm+VTXD_disk1_zoffset_stave5A_2" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave5A" step="VTXDModOverlap" phi0="pi/2.0*rad+VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="6" z_offset="VTXD_zoffset_face1+13.5*mm+VTXD_disk1_zoffset_stave6A_2" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave6A" step="VTXDModOverlap" phi0="pi/2.0*rad+VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="6" z_offset="VTXD_zoffset_face1+13.5*mm+VTXD_disk1_zoffset_stave7A_2" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk1_roffset_stave7A" step="VTXDModOverlap" phi0="pi/2.0*rad+VTXD_phi1A" module="SiVTXDStave"/>
            </layer>

            <layer id="1" z="VTXD_z2" nphi="4" dz="VTXD_dz2" rmin="VTXD_rmin2" rmax="VTXD_r_max" motherVolThickness="5.5*cm">
                <!-- Face A -->
                <stave nmodules="3" z_offset="VTXD_disk2_zoffset_stave1" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk2_roffset_stave1" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="4" z_offset="VTXD_disk2_zoffset_stave2" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk2_roffset_stave2" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="5" z_offset="VTXD_disk2_zoffset_stave3" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk2_roffset_stave3" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="6" z_offset="VTXD_disk2_zoffset_stave4" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk2_roffset_stave4" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="6" z_offset="VTXD_disk2_zoffset_stave5" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk2_roffset_stave5" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="7" z_offset="VTXD_disk2_zoffset_stave6" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk2_roffset_stave6" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>

                <!-- Face B -->
                <stave nmodules="3" z_offset="VTXD_zoffset_face2-VTXD_disk2_zoffset_stave1" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk2_roffset_stave1" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="4" z_offset="VTXD_zoffset_face2-VTXD_disk2_zoffset_stave2" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk2_roffset_stave2" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="5" z_offset="VTXD_zoffset_face2-VTXD_disk2_zoffset_stave3" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk2_roffset_stave3" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="6" z_offset="VTXD_zoffset_face2-VTXD_disk2_zoffset_stave4" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk2_roffset_stave4" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="6" z_offset="VTXD_zoffset_face2-VTXD_disk2_zoffset_stave5" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk2_roffset_stave5" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="7" z_offset="VTXD_zoffset_face2-VTXD_disk2_zoffset_stave6" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk2_roffset_stave6" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>

            </layer>         

             <layer id="2" z="VTXD_z3" nphi="4" dz="VTXD_dz3" rmin="VTXD_rmin3" rmax="VTXD_r_max" motherVolThickness="5.5*cm" reflect_rot="pi/4.0">
                <!-- Face A -->
                <stave nmodules="4" z_offset="VTXD_disk3_zoffset_stave1A" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk3_roffset_stave1A" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="5" z_offset="VTXD_disk3_zoffset_stave2A" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk3_roffset_stave2A" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="5" z_offset="VTXD_disk3_zoffset_stave3A" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk3_roffset_stave3A" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="6" z_offset="VTXD_disk3_zoffset_stave4A" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk3_roffset_stave4A" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>
                <stave nmodules="7" z_offset="VTXD_disk3_zoffset_stave5A" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk3_roffset_stave5A" step="VTXDModOverlap" phi0="VTXD_phi1A" module="SiVTXDStave"/>

                <!-- Face B -->
                <stave nmodules="4" z_offset="VTXD_zoffset_face3+VTXD_disk3_zoffset_stave1B" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk3_roffset_stave1B" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="5" z_offset="VTXD_zoffset_face3+VTXD_disk3_zoffset_stave2B" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk3_roffset_stave2B" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="5" z_offset="VTXD_zoffset_face3+VTXD_disk3_zoffset_stave3B" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk3_roffset_stave3B" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="6" z_offset="VTXD_zoffset_face3+VTXD_disk3_zoffset_stave4B" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk3_roffset_stave4B" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>
                <stave nmodules="7" z_offset="VTXD_zoffset_face3+VTXD_disk3_zoffset_stave5B" dz="VTXD_support_thickness+VTXD_stave_dz+VTXD_support_thickness" r="VTXD_disk3_roffset_stave5B" step="VTXDModOverlap" phi0="VTXD_phi1B" module="SiVTXDStave"/>
            </layer>  
        </detector>
    </detectors>   


    <!-- Plugin to define the sensitive surfaces -->
    <plugins>
        <!-- <plugin name="DD4hep_GenericSurfaceInstallerPlugin">
            <argument value="VTXIB"/> 
            <argument value="dimension=2"/>
            <argument value="u_y=1."/>
            <argument value="v_z=1."/>
            <argument value="n_x=1."/>
        </plugin> -->

        <!-- <plugin name="DD4hep_GenericSurfaceInstallerPlugin">
            <argument value="VTXOB"/> 
            <argument value="dimension=2"/>
            <argument value="u_y=1."/>
            <argument value="v_z=1."/>
            <argument value="n_x=1."/>
        </plugin> -->

        <plugin name="DD4hep_GenericSurfaceInstallerPlugin">
            <argument value="VertexEndcap"/> 
            <argument value="dimension=2"/>
            <argument value="u_x=-1."/>
            <argument value="v_y=1."/>
            <argument value="n_z=-1."/>
        </plugin>
    </plugins> 
</lccdd>