<lccdd>
    <info name="CurvedVertex_IDEA_o1_v02"
        title="Ultra-light vertex detector concept for FCC-ee using stitched wafer-scale MAPS"
        author="Armin Ilg"
        url="no"
        status="development"
        version="o1_v02"> 
        <comment>An ultra-light vertex detector for the FCC-ee IDEA detector concept. Conception by Fabrizio Palla (INFN Pisa) and Armin Ilg (UZH). Implementation by Armin Ilg (UZH)</comment>
    </info>
    <comment>Ultra-light IDEA vertex detector</comment>
    <detectors>
        <detector name="InnerVertex" type="DD4hep_SubdetectorAssembly" vis="VXDVis">
            <shape type="BooleanShape" operation="Subtraction" material="Air">
                <shape type="BooleanShape" operation="Subtraction">
                    <shape type="Tube" rmin="Beampipe_outer_r" rmax="VTXOB_r_max" dz="VTXOB_half_length"/>
                    <shape type="Cone" rmin1="0" rmax1="tan(VertexClearanceTheta)*VTXOB_half_length" rmin2="0" rmax2="0" z="VTXOB_half_length/2."/>
                    <position x="0" y="0" z="-VTXOB_half_length/2." />
                </shape>
                
                <shape type="Cone" rmin1="0" rmax1="0" rmin2="0" rmax2="tan(VertexClearanceTheta)*VTXOB_half_length" z="VTXOB_half_length/2."/>
                <position x="0" y="0" z="VTXOB_half_length/2." />
            </shape>
            <comment>Vertex Assembly</comment>
            <composite name="VTXIB"/>
        </detector>
    </detectors>

    <define>
            <constant name="M_PI" value="3.14159265359"/>

        <!-- Vertex inner barrel (VTXIB), using curved MAPS! -->
            <constant name="RSU_z" value="21.666*mm"/> <!-- Length of a single RSU in z -->
            <constant name="RSU_rphi_periphery" value="1.0525*mm"/> <!-- Assume 5% periphery -->
            <constant name="RSU_rphi_sensitive" value="21.02*mm-RSU_rphi_periphery"/> <!-- Length of a single RSU in rphi -->
            <constant name="RSU_rphi" value="RSU_rphi_sensitive+RSU_rphi_periphery"/> <!-- Length of a single RSU in rphi -->

        <!-- Vertex inner barrel parameters -->    
            <constant name="VTXIB_gap_rphi" value="1.0*mm"/>
            <constant name="VTXIB_gap_z3" value="3.0*mm"/>
            <constant name="VTXIB_gap_z4" value="3.0*mm"/>

            <constant name="Beampipe_outer_r" value="CentralBeamPipe_rmax+BeamPipeWidth"/>

            <constant name="VTXIB_r1" value="(RSU_rphi*4.+2*VTXIB_gap_rphi)/(2.0*M_PI)"/> <!-- Assume 2 mm of gap between the two sensors, so r=(18.516*4.+2*2)/(2.0*pi)=12.424 mm-->
            <constant name="VTXIB_r2" value="(RSU_rphi*6.+2*VTXIB_gap_rphi)/(2.0*M_PI)"/> <!-- Assume 2 mm of gap between the two sensors -->
            <constant name="VTXIB_r3" value="(RSU_rphi*8.+2*VTXIB_gap_rphi)/(2.0*M_PI)"/> <!-- Assume 2 mm of gap between the two sensors -->
            <constant name="VTXIB_r4" value="(RSU_rphi*10.+2*VTXIB_gap_rphi)/(2.0*M_PI)"/> <!-- Assume 2 mm of gap between the two sensors -->
            <constant name="VTXIB_r_outer" value="40.0*mm"/>     <!-- End of vertex inner barrel -->


            <constant name="VTXIB_nModules1" value="10"/>
            <constant name="VTXIB_nModules2" value="12"/>
            <constant name="VTXIB_nModules3" value="9"/>
            <constant name="VTXIB_nModules4" value="9"/>

            <constant name="VTXIB_z1" value="(VTXIB_nModules1*RSU_z)/2."/> <!-- 10*21.666 = 216.66*mm-->
            <constant name="VTXIB_z2" value="(VTXIB_nModules2*RSU_z)/2."/> <!-- 10*21.666 = 216.66*mm-->
            <constant name="VTXIB_z3" value="(VTXIB_nModules3*RSU_z)/2."/> <!-- 10*21.666 = 216.66*mm-->
            <constant name="VTXIB_z4" value="(VTXIB_nModules4*RSU_z)/2."/> <!-- 10*21.666 = 216.66*mm-->

            <constant name="VTXIB_phi0_1" value="0.0*deg"/>
            <constant name="VTXIB_phi0_2" value="8.0*deg"/>
            <constant name="VTXIB_phi0_3" value="-8.0*deg"/>
            <constant name="VTXIB_phi0_4" value="0.0*deg"/>

            <constant name="VTXIB_ring1_phi_offset" value="2*M_PI*0.5*RSU_rphi/(4.*RSU_rphi+2.*VTXIB_gap_rphi)"/>
            <constant name="VTXIB_ring2_phi_offset" value="2*M_PI*1.0*RSU_rphi/(6.*RSU_rphi+2.*VTXIB_gap_rphi)"/>
            <constant name="VTXIB_ring3_phi_offset" value="2*M_PI*1.5*RSU_rphi/(8.*RSU_rphi+2.*VTXIB_gap_rphi)"/>
            <constant name="VTXIB_ring4_phi_offset" value="2*M_PI*2.0*RSU_rphi/(10.*RSU_rphi+2.*VTXIB_gap_rphi)"/>

            <constant name="VTXIB_sensitive_thickness"   value="50e-03*mm"/>

            <constant name="VTXIB_flex_Aluminium_thickness" value="0.050*mm"/>
            <constant name="VTXIB_flex_Kapton_thickness"    value="0.200*mm"/>
            <constant name="VTXIB_flex_length"              value="20.0*mm"/>

            <!-- -->

            <!-- Properties of curved vertex support structures -->
            <constant name="VTXIB_longeron1_width" value="3.0*mm"/> <!-- width of support structure along z -->
            <constant name="VTXIB_longeron2_width" value="4.0*mm"/> <!-- width of support structure along z -->
            <constant name="VTXIB_longeron3_width" value="5.0*mm"/> <!-- width of support structure along z -->
            <constant name="VTXIB_longeron4_width" value="6.0*mm"/> <!-- width of support structure along z -->

            <constant name="VTXIB_longeron1_phi_offset" value="(0.5*RSU_rphi+VTXIB_longeron1_width/4.)/(4.*RSU_rphi+2.*VTXIB_gap_rphi)*360.0*deg"/>
            <constant name="VTXIB_longeron2_phi_offset" value="(0.5*RSU_rphi+VTXIB_longeron2_width/4.)/(6.*RSU_rphi+2.*VTXIB_gap_rphi)*360.0*deg"/>
            <constant name="VTXIB_longeron3_phi_offset" value="(0.5*RSU_rphi+VTXIB_longeron3_width/4.)/(8.*RSU_rphi+2.*VTXIB_gap_rphi)*360.0*deg"/>
            <constant name="VTXIB_longeron4_phi_offset" value="(0.5*RSU_rphi+VTXIB_longeron4_width/4.)/(10.*RSU_rphi+2.*VTXIB_gap_rphi)*360.0*deg"/>

            <constant name="VTXIB_support_ring_length" value="3.5*mm"/>
            <constant name="VTXIB_ring_zoffset" value="-1.5*mm"/>
            <constant name="VTXIB_intermed_ring1_width" value="(RSU_rphi+0.5*VTXIB_gap_rphi)-VTXIB_longeron1_width"/>
            <constant name="VTXIB_intermed_ring2_width" value="(1.5*RSU_rphi+0.5*VTXIB_gap_rphi)-VTXIB_longeron2_width"/>
            <constant name="VTXIB_intermed_ring3_width" value="(RSU_rphi+0.5*VTXIB_gap_rphi)-VTXIB_longeron3_width"/>
            <constant name="VTXIB_intermed_ring4_width" value="(RSU_rphi+0.5*VTXIB_gap_rphi)-VTXIB_longeron4_width"/>
            
            <!-- Properties of structures at sides of sensor -->
            <constant name="VTXIB_endcap1_length" value="3.0*mm"/>
            <constant name="VTXIB_endcap2_length" value="3.0*mm"/>
            <constant name="VTXIB_endcap3_length_center" value="1.5*mm"/>
            <constant name="VTXIB_endcap3_length_side" value="4.5*mm"/>
            <constant name="VTXIB_endcap4_length_center" value="3.0*mm"/>
            <constant name="VTXIB_endcap4_length_side" value="3.0*mm"/>

            <constant name="VTXIB_curved_tolerance_r" value="0.1*mm"/> <!-- To get rid of overlaps when visualising the geometry, SET TO 0 FOR OTHER PURPOSES! -->
           <!-- <constant name="VTXIB_curved_tolerance_r" value="0.1*mm"/> -->

    </define>        


    <!--  Definition of the readout segmentation/definition  -->
    <readouts>
        <readout name="VTXIBCollection">
            <segmentation type="CartesianGridYZ" grid_size_y="0.025*mm" grid_size_z="0.025*mm"/>  <!-- Pixels of 25x25 Âµm-->
            <id>${GlobalTrackerReadoutID},y:32:-16,z:-16</id>
        </readout>
    </readouts>

   <detectors>
 
    <!-- Vertex inner barrel -->
        <detector name="VTXIB" type="VertexCylindrical_o1_v01" vis="VXDVis" id="DetID_VXD_IB" readout="VTXIBCollection"  region="VTXIBRegion">
            <envelope vis="VXDVis">
                <shape type="Assembly"/>
            </envelope>
            <type_flags type=" DetType_TRACKER + DetType_PIXEL + DetType_VERTEX + DetType_BARREL"/>
            
            <!-- Curved object -->
            <stave name="SiVTXIBStave1Curved" r="VTXIB_r1">
                <!-- Sensor -->
                <sensor thickness="VTXIB_sensitive_thickness" material="Silicon">
                    <!-- First segment -->
                    <component sensitive="False"    xmin="0.0*RSU_rphi-RSU_rphi/2."                     xmax="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="0.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <!-- Second segment -->
                    <component sensitive="False"    xmin="1.0*RSU_rphi-RSU_rphi/2."                     xmax="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="1.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>
                </sensor>

                <!-- Longerons -->
                <components name="support_longeron" r="VTXIB_sensitive_thickness" length="VTXIB_z1+VTXIB_endcap1_length-VTXIB_support_ring_length+VTXIB_ring_zoffset">
                    <component thickness="VTXIB_r2-VTXIB_r1-VTXIB_curved_tolerance_r" width="VTXIB_longeron1_width" offset="0.0*mm" phi_offset="90.0*deg-VTXIB_longeron1_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- first longeron -->
                    <component thickness="VTXIB_r2-VTXIB_r1-VTXIB_curved_tolerance_r" width="VTXIB_longeron1_width" offset="0.0*mm" phi_offset="0.0*deg-VTXIB_longeron1_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- second longeron -->
                </components>

                <end_z name="endOfStave">
                    <!-- Readout electronics on wafer -->
                    <component thickness="VTXIB_sensitive_thickness" width="2.0*RSU_rphi" length="VTXIB_endcap1_length" phi_offset="VTXIB_ring1_phi_offset" isCurved="true" material="Silicon" vis="SiPeripheryVis"/>
    
                    <!-- Readout flexes -->
                    <component thickness="VTXIB_flex_Aluminium_thickness"   width="2.0*RSU_rphi" length="VTXIB_flex_length" phi_offset="VTXIB_ring1_phi_offset" isCurved="true" vis="CableVis" dz="VTXIB_endcap1_length" material="Al"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"      width="2.0*RSU_rphi" length="VTXIB_flex_length" phi_offset="VTXIB_ring1_phi_offset" isCurved="true" vis="CableVis" dz="VTXIB_endcap1_length" material="Kapton" r="VTXIB_flex_Aluminium_thickness"/>
                </end_z>

                <!-- Support rings -->
                <end_z name="endOfStave" r="VTXIB_sensitive_thickness">
                    <component thickness="VTXIB_r2-VTXIB_r1-VTXIB_sensitive_thickness-VTXIB_curved_tolerance_r" width="M_PI*(VTXIB_r1+VTXIB_sensitive_thickness)" length="VTXIB_support_ring_length" phi_offset="VTXIB_ring1_phi_offset" isCurved="true" material="CarbonFoam" vis="CarbonFoam" dz="+VTXIB_endcap1_length-VTXIB_support_ring_length+VTXIB_ring_zoffset"/>
                </end_z>
            </stave>

            <stave name="SiVTXIBStave2Curved" r="VTXIB_r2">
                <sensor thickness="VTXIB_sensitive_thickness" material="Silicon">
                    <!-- First segment -->
                    <component sensitive="False"    xmin="0.0*RSU_rphi-RSU_rphi/2."                     xmax="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="0.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <!-- Second segment -->
                    <component sensitive="False"    xmin="1.0*RSU_rphi-RSU_rphi/2."                     xmax="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="1.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <!-- Third segment -->
                    <component sensitive="False"    xmin="2.0*RSU_rphi-RSU_rphi/2."                     xmax="2.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="2.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="2.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>
                </sensor>

                <components name="support_longeron" r="VTXIB_sensitive_thickness" length="VTXIB_z2+VTXIB_endcap2_length-VTXIB_support_ring_length+VTXIB_ring_zoffset">
                    <component thickness="VTXIB_r3-VTXIB_r2-VTXIB_curved_tolerance_r" width="VTXIB_longeron2_width" offset="0.0*mm" phi_offset="90.0*deg-VTXIB_longeron2_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- first longeron -->
                    <component thickness="VTXIB_r3-VTXIB_r2-VTXIB_curved_tolerance_r" width="VTXIB_longeron2_width" offset="0.0*mm" phi_offset="0.0*deg-VTXIB_longeron2_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- second longeron -->
                </components> 
                
                <end_z name="endOfStave">
                    <component thickness="VTXIB_sensitive_thickness"        width="3.0*RSU_rphi" length="VTXIB_endcap2_length" phi_offset="VTXIB_ring2_phi_offset" isCurved="true" material="Silicon" vis="SiPeripheryVis"/>
                    <component thickness="VTXIB_flex_Aluminium_thickness"   width="3.0*RSU_rphi" length="VTXIB_flex_length" phi_offset="VTXIB_ring2_phi_offset" isCurved="true" material="Al" vis="CableVis" dz="VTXIB_endcap2_length"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"      width="3.0*RSU_rphi" length="VTXIB_flex_length" phi_offset="VTXIB_ring2_phi_offset" isCurved="true" material="Kapton" vis="CableVis" dz="VTXIB_endcap2_length" r="VTXIB_flex_Aluminium_thickness"/>
                </end_z>

                <end_z name="endOfStave" r="VTXIB_sensitive_thickness">
                    <!-- Sides, one per half barrel -->
                    <component thickness="VTXIB_r3-VTXIB_r2-VTXIB_sensitive_thickness-VTXIB_curved_tolerance_r" width="M_PI*(VTXIB_r2+VTXIB_sensitive_thickness)" length="VTXIB_support_ring_length" phi_offset="VTXIB_ring2_phi_offset" isCurved="true" material="CarbonFoam" vis="CarbonFoam" dz="+VTXIB_endcap2_length-VTXIB_support_ring_length+VTXIB_ring_zoffset"/>
                </end_z>
            </stave>

            <stave name="SiVTXIBStave3Curved" r="VTXIB_r3">
                <sensor thickness="VTXIB_sensitive_thickness" material="Silicon">
                    <component sensitive="False"    xmin="0.0*RSU_rphi-RSU_rphi/2."                     xmax="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="0.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="1.0*RSU_rphi-RSU_rphi/2."                     xmax="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="1.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="2.0*RSU_rphi-RSU_rphi/2."                     xmax="2.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="2.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="2.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="3.0*RSU_rphi-RSU_rphi/2."                     xmax="3.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="3.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="3.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>
                </sensor>

                <components name="support_longeron" r="VTXIB_sensitive_thickness" length="VTXIB_z3+VTXIB_endcap3_length_center-VTXIB_support_ring_length+VTXIB_ring_zoffset">
                    <component thickness="VTXIB_r4-VTXIB_r3-VTXIB_curved_tolerance_r" width="VTXIB_longeron3_width" offset="0.0*mm" phi_offset="90.0*deg-VTXIB_longeron3_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- first longeron -->
                    <component thickness="VTXIB_r4-VTXIB_r3-VTXIB_curved_tolerance_r" width="VTXIB_longeron3_width" offset="0.0*mm" phi_offset="0.0*deg-VTXIB_longeron3_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- second longeron -->
                </components>

                <end_z name="endOfStave">
                    <component thickness="VTXIB_flex_Aluminium_thickness"   width="4.0*RSU_rphi" length="VTXIB_flex_length" phi_offset="VTXIB_ring3_phi_offset" isCurved="true" material="Al" vis="CableVis" dz="VTXIB_endcap3_length_center" side="+1"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"      width="4.0*RSU_rphi" length="VTXIB_flex_length" phi_offset="VTXIB_ring3_phi_offset" isCurved="true" material="Kapton" vis="CableVis" dz="VTXIB_endcap3_length_side" side="+1" r="VTXIB_flex_Aluminium_thickness"/>
                    <component thickness="VTXIB_sensitive_thickness" width="4.0*RSU_rphi" length="VTXIB_endcap3_length_center" phi_offset="VTXIB_ring3_phi_offset" isCurved="true" material="Silicon" vis="SiPeripheryVis" side="-1"/>
                    <component thickness="VTXIB_sensitive_thickness" width="4.0*RSU_rphi" length="VTXIB_endcap3_length_side"   phi_offset="VTXIB_ring3_phi_offset" isCurved="true" material="Silicon" vis="SiPeripheryVis" side="+1"/>
                </end_z>

                <end_z name="endOfStave" r="VTXIB_sensitive_thickness">
                    <component thickness="VTXIB_r4-VTXIB_r3-VTXIB_sensitive_thickness-VTXIB_curved_tolerance_r" width="M_PI*(VTXIB_r3+VTXIB_sensitive_thickness)" length="VTXIB_support_ring_length" phi_offset="VTXIB_ring3_phi_offset" isCurved="true" material="CarbonFoam" vis="CarbonFoam" dz="+VTXIB_endcap3_length_center-VTXIB_support_ring_length+VTXIB_ring_zoffset"/>
                </end_z>
            </stave>

            <stave name="SiVTXIBStave3Curved_2" r="VTXIB_r3">
                <sensor thickness="VTXIB_sensitive_thickness" material="Silicon">
                    <component sensitive="False"    xmin="0.0*RSU_rphi-RSU_rphi/2."                     xmax="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="0.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="1.0*RSU_rphi-RSU_rphi/2."                     xmax="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="1.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="2.0*RSU_rphi-RSU_rphi/2."                     xmax="2.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="2.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="2.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="3.0*RSU_rphi-RSU_rphi/2."                     xmax="3.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="3.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="3.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>
                </sensor>

                <components name="support_longeron" r="VTXIB_sensitive_thickness" length="VTXIB_z3+VTXIB_endcap3_length_center-VTXIB_support_ring_length+VTXIB_ring_zoffset">
                    <component thickness="VTXIB_r4-VTXIB_r3-VTXIB_curved_tolerance_r" width="VTXIB_longeron3_width" offset="0.0*mm" phi_offset="90.0*deg-VTXIB_longeron3_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- first longeron -->
                    <component thickness="VTXIB_r4-VTXIB_r3-VTXIB_curved_tolerance_r" width="VTXIB_longeron3_width" offset="0.0*mm" phi_offset="0.0*deg-VTXIB_longeron3_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- second longeron -->
                </components>

                <end_z name="endOfStave">
                    <component thickness="VTXIB_flex_Aluminium_thickness"   width="4.0*RSU_rphi" length="VTXIB_flex_length" phi_offset="VTXIB_ring3_phi_offset" isCurved="true" material="Al" vis="CableVis" dz="VTXIB_endcap3_length_center" side="-1"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"      width="4.0*RSU_rphi" length="VTXIB_flex_length" phi_offset="VTXIB_ring3_phi_offset" isCurved="true" material="Kapton" vis="CableVis" dz="VTXIB_endcap3_length_side" side="-1" r="VTXIB_flex_Aluminium_thickness"/>
                    <component thickness="VTXIB_sensitive_thickness" width="4.0*RSU_rphi" length="VTXIB_endcap3_length_center" phi_offset="VTXIB_ring3_phi_offset" isCurved="true" material="Silicon" vis="SiPeripheryVis" side="+1"/>
                    <component thickness="VTXIB_sensitive_thickness" width="4.0*RSU_rphi" length="VTXIB_endcap3_length_side"   phi_offset="VTXIB_ring3_phi_offset" isCurved="true" material="Silicon" vis="SiPeripheryVis" side="-1"/>
                </end_z>

                <end_z name="endOfStave" r="VTXIB_sensitive_thickness">
                    <component thickness="VTXIB_r4-VTXIB_r3-VTXIB_sensitive_thickness-VTXIB_curved_tolerance_r" width="M_PI*(VTXIB_r3+VTXIB_sensitive_thickness)" length="VTXIB_support_ring_length" phi_offset="VTXIB_ring3_phi_offset" isCurved="true" material="CarbonFoam" vis="CarbonFoam" dz="+VTXIB_endcap3_length_center-VTXIB_support_ring_length+VTXIB_ring_zoffset"/>
                </end_z>
            </stave>

            <stave name="SiVTXIBStave4Curved" r="VTXIB_r4">
                <sensor thickness="VTXIB_sensitive_thickness" material="Silicon">
                    <component sensitive="False"    xmin="0.0*RSU_rphi-RSU_rphi/2."                     xmax="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="0.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="1.0*RSU_rphi-RSU_rphi/2."                     xmax="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="1.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="2.0*RSU_rphi-RSU_rphi/2."                     xmax="2.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="2.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="2.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="3.0*RSU_rphi-RSU_rphi/2."                     xmax="3.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="3.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="3.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="4.0*RSU_rphi-RSU_rphi/2."                     xmax="4.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="4.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="4.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>
                </sensor>

                <components name="support_longeron" r="VTXIB_sensitive_thickness" length="VTXIB_z4+VTXIB_endcap4_length_center-VTXIB_support_ring_length+VTXIB_ring_zoffset">
                    <component thickness="VTXIB_r_outer-VTXIB_r4" width="VTXIB_longeron4_width" offset="0.0*mm" phi_offset="90.0*deg-VTXIB_longeron4_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- first longeron -->
                    <component thickness="VTXIB_r_outer-VTXIB_r4" width="VTXIB_longeron4_width" offset="0.0*mm" phi_offset="0.0*deg-VTXIB_longeron4_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- second longeron -->
                </components>

                <end_z name="endOfStave">
                    <component thickness="VTXIB_flex_Aluminium_thickness"   width="5.0*RSU_rphi" length="VTXIB_flex_length" phi_offset="VTXIB_ring4_phi_offset" isCurved="true" material="Al" vis="CableVis" dz="VTXIB_endcap4_length_center" side="+1"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"      width="5.0*RSU_rphi" length="VTXIB_flex_length" phi_offset="VTXIB_ring4_phi_offset" isCurved="true" material="Kapton" vis="CableVis" dz="VTXIB_endcap4_length_side" side="+1" r="VTXIB_flex_Aluminium_thickness"/>
                    <component thickness="VTXIB_sensitive_thickness" width="5.0*RSU_rphi" length="VTXIB_endcap4_length_center" phi_offset="VTXIB_ring4_phi_offset" isCurved="true" material="Silicon" vis="SiPeripheryVis" side="-1"/>
                    <component thickness="VTXIB_sensitive_thickness" width="5.0*RSU_rphi" length="VTXIB_endcap4_length_side" phi_offset="VTXIB_ring4_phi_offset" isCurved="true" material="Silicon" vis="SiPeripheryVis" side="+1"/>
                </end_z>

                <end_z name="endOfStave" r="VTXIB_sensitive_thickness">
                    <component thickness="VTXIB_r_outer-VTXIB_r4-VTXIB_sensitive_thickness" width="M_PI*(VTXIB_r4+VTXIB_sensitive_thickness)" length="VTXIB_support_ring_length" phi_offset="VTXIB_ring4_phi_offset" isCurved="true" material="CarbonFoam" vis="CarbonFoam" dz="+VTXIB_endcap4_length_center-VTXIB_support_ring_length+VTXIB_ring_zoffset"/>
                </end_z>
            </stave>

            <stave name="SiVTXIBStave4Curved_2" r="VTXIB_r4">
                <sensor thickness="VTXIB_sensitive_thickness" material="Silicon">
                    <component sensitive="False"    xmin="0.0*RSU_rphi-RSU_rphi/2."                     xmax="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="0.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="0.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="1.0*RSU_rphi-RSU_rphi/2."                     xmax="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="1.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="1.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="2.0*RSU_rphi-RSU_rphi/2."                     xmax="2.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="2.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="2.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="3.0*RSU_rphi-RSU_rphi/2."                     xmax="3.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="3.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="3.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>

                    <component sensitive="False"    xmin="4.0*RSU_rphi-RSU_rphi/2."                     xmax="4.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiPeripheryVis"/>
                    <component sensitive="True"     xmin="4.0*RSU_rphi-RSU_rphi/2.+RSU_rphi_periphery"  xmax="4.0*RSU_rphi+RSU_rphi/2."                     ymin="-RSU_z/2." ymax="+RSU_z/2." isCurved="true" vis="SiSensitiveVis"/>
                </sensor>

                <components name="support_longeron" r="VTXIB_sensitive_thickness" length="VTXIB_z4+VTXIB_endcap4_length_center-VTXIB_support_ring_length+VTXIB_ring_zoffset">
                    <component thickness="VTXIB_r_outer-VTXIB_r4" width="VTXIB_longeron4_width" offset="0.0*mm" phi_offset="90.0*deg-VTXIB_longeron4_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- first longeron -->
                    <component thickness="VTXIB_r_outer-VTXIB_r4" width="VTXIB_longeron4_width" offset="0.0*mm" phi_offset="0.0*deg-VTXIB_longeron4_phi_offset" material="CarbonFoam" isCurved="true" vis="CarbonFoam"/> <!-- second longeron -->
                </components>

                <end_z name="endOfStave">
                    <component thickness="VTXIB_flex_Aluminium_thickness"   width="5.0*RSU_rphi" length="VTXIB_flex_length" phi_offset="VTXIB_ring4_phi_offset" isCurved="true" material="Al" vis="CableVis" dz="VTXIB_endcap4_length_center" side="-1"/>
                    <component thickness="VTXIB_flex_Kapton_thickness"      width="5.0*RSU_rphi" length="VTXIB_flex_length" phi_offset="VTXIB_ring4_phi_offset" isCurved="true" material="Kapton" vis="CableVis" dz="VTXIB_endcap4_length_side" side="-1" r="VTXIB_flex_Aluminium_thickness"/>
                    <component thickness="VTXIB_sensitive_thickness" width="5.0*RSU_rphi" length="VTXIB_endcap4_length_center" phi_offset="VTXIB_ring4_phi_offset" isCurved="true" material="Silicon" vis="SiPeripheryVis" side="+1"/>
                    <component thickness="VTXIB_sensitive_thickness" width="5.0*RSU_rphi" length="VTXIB_endcap4_length_side" phi_offset="VTXIB_ring4_phi_offset" isCurved="true" material="Silicon" vis="SiPeripheryVis" side="-1"/>
                </end_z>

                <end_z name="endOfStave" r="VTXIB_sensitive_thickness">
                    <component thickness="VTXIB_r_outer-VTXIB_r4-VTXIB_sensitive_thickness" width="M_PI*(VTXIB_r4+VTXIB_sensitive_thickness)" length="VTXIB_support_ring_length" phi_offset="VTXIB_ring4_phi_offset" isCurved="true" material="CarbonFoam" vis="CarbonFoam" dz="+VTXIB_endcap4_length_center-VTXIB_support_ring_length+VTXIB_ring_zoffset"/>
                </end_z>
            </stave>

            <!-- Here we construct the barrel -->
            <layer nLadders="2" phi0="0.5*RSU_rphi/(2*M_PI*VTXIB_r1)*360.*deg+VTXIB_phi0_1" id="0" nmodules="VTXIB_nModules1" name="SiVTXIBStave1Curved" step="0.0*mm"/>
            <!-- <layer nLadders="2" phi0="0.5*RSU_rphi/(2*M_PI*VTXIB_r2)*360.*deg+VTXIB_phi0_2" id="1" nmodules="VTXIB_nModules2" name="SiVTXIBStave2Curved" step="0.0*mm"/>
            <layer nLadders="2" phi0="0.5*RSU_rphi/(2*M_PI*VTXIB_r3)*360.*deg+VTXIB_phi0_3" id="2" nmodules="VTXIB_nModules3" name="SiVTXIBStave3Curved"    step="0.0*mm" z_offset="VTXIB_z3+VTXIB_endcap3_length_center+VTXIB_gap_z3/2."/>
            <layer nLadders="2" phi0="0.5*RSU_rphi/(2*M_PI*VTXIB_r3)*360.*deg+VTXIB_phi0_3" id="3" nmodules="VTXIB_nModules3" name="SiVTXIBStave3Curved_2"  step="0.0*mm" z_offset="-(VTXIB_z3+VTXIB_endcap3_length_center+VTXIB_gap_z3/2.)"/>
            <layer nLadders="2" phi0="0.5*RSU_rphi/(2*M_PI*VTXIB_r4)*360.*deg+VTXIB_phi0_4" id="4" nmodules="VTXIB_nModules4" name="SiVTXIBStave4Curved"    step="0.0*mm" z_offset="VTXIB_z4+VTXIB_endcap4_length_center+VTXIB_gap_z4/2."/>
            <layer nLadders="2" phi0="0.5*RSU_rphi/(2*M_PI*VTXIB_r4)*360.*deg+VTXIB_phi0_4" id="5" nmodules="VTXIB_nModules4" name="SiVTXIBStave4Curved_2"  step="0.0*mm" z_offset="-(VTXIB_z4+VTXIB_endcap4_length_center+VTXIB_gap_z4/2.)"/> -->
        </detector>
    </detectors>
   
    <!-- No need to use plugin to load surfaces, they're included in VertexCylindrical constructor! -->
</lccdd>